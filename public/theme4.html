<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Wedding Invitation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <!-- SweetAlert2 (for RSVP alerts) -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Supabase JS v2 -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    :root {
      --bg: #f4fbf6;
      --bg-soft: #e7f5ec;
      --ink: #23352c;
      --ink-soft: #4b6b5a;
      --muted: #7f9b8a;
      --accent: #73c49a;
      --accent-soft: rgba(115, 196, 154, 0.12);
      --accent-deep: #4f9c75;
      --radius-lg: 22px;
      --radius-pill: 999px;
      --transition-fast: 180ms ease-out;
      --transition-med: 260ms ease-out;
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      font-family: "DM Sans", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, #ffffff 0, #f4fbf6 40%, #e3f2ea 100%);
      color: var(--ink);
      scroll-behavior: smooth;
    }

    body { min-height: 100vh; }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ---------------------- */
    /* Hero                   */
    /* ---------------------- */

    .hero-wrapper { position: relative; padding: 14px 12px 8px; }
    @media (min-width: 960px) { .hero-wrapper { padding: 20px 28px 8px; } }

    .hero-shell {
      max-width: 1080px;
      margin: 0 auto;
      position: relative;
      border-radius: 32px;
      overflow: hidden;
      background: radial-gradient(circle at top, #e7f5ec 0, #f4fbf6 40%, #e0f0e6 100%);
      text-align: center;
    }

    .hero-photo {
      position: relative;
      height: clamp(240px, 45vh, 360px);
      background: linear-gradient(135deg, #cce7d8, #e3f2ea);
      overflow: hidden;
    }

    .hero-photo::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.7), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(129, 199, 163, 0.35), transparent 55%);
      mix-blend-mode: soft-light;
      opacity: 0.9;
      pointer-events: none;
    }

    /* ✅ removed inset/margins so it fills the container */
    .hero-photo-inner {
      position: absolute;
      inset: 0;
      border-radius: 0;
      overflow: hidden;
      background: #c9e3d4 center/cover no-repeat;
      transform-origin: center;
      opacity: 1;
      transition:
        opacity 520ms ease-in-out,
        transform 380ms ease-out;
    }

    .hero-photo-inner.has-image { background-size: cover; }
    .hero-photo-inner.fading { opacity: 0; }

    .hero-photo-tag {
      position: absolute;
      top: 18px; left: 18px;
      padding: 6px 14px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.23em;
      color: #f8fff9;
      background: rgba(22, 40, 30, 0.76);
      border-radius: var(--radius-pill);
      backdrop-filter: blur(10px);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      z-index: 2;
    }

    .hero-photo-tag::before {
      content: "";
      width: 8px; height: 8px;
      border-radius: 999px;
      background: var(--accent);
    }

    .hero-content { padding: 26px 18px 22px; text-align: center; }

    .hero-eyebrow {
      font-size: 11px;
      letter-spacing: 0.26em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .hero-names {
      font-family: "Playfair Display", "Times New Roman", serif;
      font-weight: 500;
      font-size: clamp(32px, 5vw, 46px);
      letter-spacing: 0.18em;
      text-transform: uppercase;
      margin-top: 10px;
      color: #254032;
    }

    .hero-subtitle {
      font-size: 14px;
      color: var(--ink-soft);
      max-width: 560px;
      margin: 12px auto 0;
      line-height: 1.7;
      white-space: pre-line;
      text-align: center;
    }

    .hero-subtitle em {
      font-family: "Playfair Display", serif;
      font-style: italic;
      color: var(--accent-deep);
    }

    .hero-meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-top: 16px;
      font-size: 12px;
      color: var(--ink-soft);
      text-align: center;
    }

    .hero-meta-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .hero-meta-dot {
      width: 6px; height: 6px;
      border-radius: 999px;
      background: var(--accent-deep);
    }

    /* COUNTDOWN */
    .countdown-row {
      margin-top: 14px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 8px;
      text-align: center;
    }
    .countdown-box {
      min-width: 64px;
      padding: 8px 10px;
      border-radius: 16px;
      background: rgba(255,255,255,0.85);
      border: 1px solid rgba(121, 158, 136, 0.5);
      box-shadow: 0 10px 24px rgba(93, 130, 109, 0.15);
      text-align: center;
    }
    .countdown-number {
      font-weight: 700;
      font-size: 18px;
      color: #274536;
      line-height: 1;
    }
    .countdown-label {
      margin-top: 4px;
      font-size: 10px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--muted);
    }
    .countdown-note {
      width: 100%;
      text-align: center;
      font-size: 11px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--muted);
      margin-top: 2px;
    }

    .hero-cta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-top: 18px;
    }

    .hero-btn {
      border-radius: var(--radius-pill);
      padding: 9px 18px;
      font-size: 13px;
      font-weight: 500;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition:
        background var(--transition-med),
        color var(--transition-med),
        transform var(--transition-fast);
    }

    .hero-btn.primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-deep));
      color: #f7fff8;
    }

    .hero-btn.primary:hover { transform: translateY(-1px); }

    .hero-btn.ghost {
      background: rgba(255, 255, 255, 0.8);
      color: var(--accent-deep);
    }

    .hero-btn.ghost:hover { background: #ffffff; }

    .hero-kicker {
      margin-top: 14px;
      font-size: 11px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--muted);
      white-space: pre-line;
      text-align: center;
    }

    /* ---------------------- */
    /* Main layout            */
    /* ---------------------- */

    main { flex: 1; padding: 10px 14px 26px; }
    @media (min-width: 960px) { main { padding: 16px 40px 32px; } }

    .sections-grid {
      max-width: 1080px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.2fr);
      gap: 24px;
    }

    @media (max-width: 900px) {
      .sections-grid { grid-template-columns: minmax(0, 1fr); }
    }

    .sections-left,
    .sections-right {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    /* ✅ separate div container per section */
    .section-block {
      background: transparent;
      border: none;
      padding: 0;
      border-radius: 0;
      box-shadow: none;
      position: relative;
      text-align: center; /* ✅ center everything */
    }

    .section-header { margin-bottom: 6px; text-align: center; }

    .section-title {
      font-family: "Playfair Display", serif;
      font-weight: 500;
      font-size: 17px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: #274536;
      text-align: center;
    }

    .section-subtitle {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.22em;
      color: var(--muted);
      margin-top: 4px;
      text-align: center;
    }

    .section-body {
      font-size: 14px;
      color: var(--ink-soft);
      margin-top: 10px;
      white-space: pre-line;
      text-align: center;
    }

    /* The Day */
    #details-date-time {
      font-family: "Playfair Display", serif;
      font-size: 15px;
      color: #2e4c3a;
      margin-bottom: 10px;
      text-align: center;
      white-space: normal;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
      justify-content: center; /* ✅ */
    }

    .pill {
      border-radius: var(--radius-pill);
      padding: 4px 10px;
      background: var(--accent-soft);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--accent-deep);
    }

    .venue-list { display: grid; gap: 8px; }

    .venue-item {
      background: linear-gradient(135deg, rgba(231, 245, 236, 0.9), rgba(244, 251, 246, 0.6));
      border-radius: 18px;
      padding: 10px 12px;
      text-align: center; /* ✅ */
    }

    .venue-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--muted);
      margin-bottom: 4px;
      text-align: center;
    }

    .venue-name {
      font-weight: 600;
      font-size: 14px;
      color: var(--ink);
      text-align: center;
    }

    .venue-address {
      font-size: 13px;
      color: var(--ink-soft);
      margin-top: 2px;
      white-space: pre-line;
      text-align: center;
    }

    .venue-notes {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
      font-style: italic;
      white-space: pre-line;
      text-align: center;
    }

    .venue-link {
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 6px;
      color: var(--accent-deep);
      text-decoration: none;
      justify-content: center;
    }

    .venue-link span {
      border-bottom: 1px dotted rgba(79, 156, 117, 0.7);
    }

    .story-block {
      margin-top: 6px;
      font-size: 14px;
      line-height: 1.8;
      color: var(--ink-soft);
      white-space: pre-line;
      text-align: center;
    }

    .verse-box {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(231, 245, 236, 0.8);
      border: 1px dashed rgba(121, 158, 136, 0.6);
      text-align: center;
    }

    .verse-text { font-style: italic; color: #2e4c3a; margin-bottom: 4px; }
    .verse-ref {
      font-size: 11px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--muted);
      text-align: center;
    }

    /* Entourage */
    .entourage-columns {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 18px;
      margin-top: 6px;
      text-align: center; /* ✅ */
    }

    @media (max-width: 640px) { .entourage-columns { grid-template-columns: 1fr; } }

    .entourage-group-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--muted);
      margin-bottom: 4px;
      text-align: center;
    }

    .entourage-list {
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-line;
      text-align: center;
    }

    /* Dress */
    .dress-title {
      font-family: "Playfair Display", serif;
      font-size: 14px;
      color: #274536;
      margin-top: 6px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      text-align: center;
    }

    .dress-colors {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      justify-content: center; /* ✅ */
    }

    .color-dot {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      border: 2px solid rgba(255, 255, 255, 0.9);
      box-shadow: 0 8px 20px rgba(93, 130, 109, 0.45);
    }

    /* Video */
    .video-wrapper {
      border-radius: 22px;
      overflow: hidden;
      
    }

    .video-inner { position: relative; padding-top: 56.25%; }
    .video-inner iframe { position: absolute; inset: 0; width: 100%; height: 100%; border: 0; }

    .video-note { font-size: 11px; color: var(--muted); margin-top: 6px; text-align: center; }

    /* Gallery */
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 6px;
      margin-top: 10px;
      justify-items: center; /* ✅ */
    }
    @media (max-width: 600px) { .gallery-grid { grid-template-columns: repeat(2, 1fr); } }

    .gallery-item {
      position: relative;
      border-radius: 18px;
      overflow: hidden;
      aspect-ratio: 4 / 5;
      background: #d2e8dc;
      cursor: pointer;
      transition: transform var(--transition-fast), filter 200ms ease-out;
    }

    .gallery-item img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .gallery-item:hover { transform: translateY(-2px); filter: saturate(1.05); }

    .gallery-more { font-size: 11px; color: var(--muted); margin-top: 6px; text-align: center; }

    /* RSVP */
    .rsvp-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 8px;
      text-align: center;
    }

    .field-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--muted);
      margin-bottom: 2px;
      text-align: center;
    }
    .field-label span { color: var(--accent-deep); }

    input[type="text"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      border-radius: 14px;
      border: 1px solid rgba(121, 158, 136, 0.7);
      padding: 8px 10px;
      font-size: 13px;
      background: rgba(244, 251, 246, 0.9);
      color: var(--ink);
      outline: none;
      resize: vertical;
      text-align: center; /* ✅ */
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
    }

    textarea { min-height: 72px; max-height: 160px; }

    input:focus, select:focus, textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(115, 196, 154, 0.4);
      background: #fff;
    }

    .btn-submit {
      align-self: center; /* ✅ */
      border-radius: var(--radius-pill);
      padding: 8px 18px;
      border: none;
      background: linear-gradient(135deg, var(--accent), var(--accent-deep));
      color: #f7fff9;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast);
    }

    .btn-submit:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 30px rgba(115, 196, 154, 0.4);
    }

    .rsvp-list {
      margin-top: 10px;
      padding-top: 6px;
      border-top: 1px solid rgba(160, 192, 170, 0.5);
      max-height: 220px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: rgba(160, 192, 170, 0.8) transparent;
      text-align: center;
    }

    .rsvp-item {
      padding: 6px 0;
      border-bottom: 1px dashed rgba(175, 203, 183, 0.8);
      font-size: 13px;
      text-align: center;
    }
    .rsvp-item:last-child { border-bottom: none; }

    .rsvp-name-row {
      display: flex;
      justify-content: center; /* ✅ */
      align-items: baseline;
      gap: 10px;
      text-align: center;
    }

    .rsvp-name { font-weight: 600; color: var(--ink); }
    .rsvp-status {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--muted);
    }

    .rsvp-meta { font-size: 11px; color: var(--muted); margin-top: 2px; text-align: center; }
    .rsvp-message { font-size: 13px; color: var(--ink-soft); margin-top: 3px; white-space: pre-line; text-align: center; }

    /* Footer */
    .footer {
      max-width: 1080px;
      margin: 18px auto 0;
      text-align: center;
      font-size: 11px;
      color: var(--muted);
      padding: 0 16px 20px;
      letter-spacing: 0.24em;
      text-transform: uppercase;
    }

    /* Loading / error */
    .center-note { text-align: center; font-size: 14px; color: var(--muted); padding: 24px 16px; }

    .loading-dot {
      display: inline-block;
      width: 6px; height: 6px;
      border-radius: 999px;
      background: var(--accent);
      margin-inline: 2px;
      animation: pulse 900ms ease-in-out infinite;
    }
    .loading-dot:nth-child(2) { animation-delay: 120ms; }
    .loading-dot:nth-child(3) { animation-delay: 240ms; }

    @keyframes pulse {
      0%, 100% { transform: translateY(0); opacity: 0.2; }
      50% { transform: translateY(-3px); opacity: 1; }
    }

    /* Scroll animations */
    .section-animate {
      opacity: 0;
      transform: translateY(26px);
      transition: opacity 480ms ease-out, transform 520ms ease-out;
      will-change: opacity, transform;
    }
    .section-animate.in-view { opacity: 1; transform: translateY(0); }

    /* Lightbox */
    .lightbox { position: fixed; inset: 0; z-index: 999; display: none; }
    .lightbox-backdrop { position: absolute; inset: 0; background: rgba(22, 35, 27, 0.9); backdrop-filter: blur(6px); }
    .lightbox-inner {
      position: absolute;
      inset: 40px 16px 40px;
      display: flex; align-items: center; justify-content: center;
      pointer-events: none;
    }
    .lightbox-figure {
      margin: 0;
      max-width: min(960px, 100%);
      max-height: 100%;
      border-radius: 18px;
      overflow: hidden;
      pointer-events: auto;
      background: #e0f0e6;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.7);
    }
    .lightbox-figure img { display: block; max-width: 100%; max-height: 100%; object-fit: contain; }

    .lightbox-close,
    .lightbox-arrow {
      position: absolute;
      border: none;
      background: rgba(22, 35, 27, 0.92);
      color: #f4fbf6;
      cursor: pointer;
      pointer-events: auto;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 999px;
    }

    .lightbox-close {
      top: 18px; right: 22px;
      width: 32px; height: 32px;
      font-size: 20px;
    }

    .lightbox-arrow {
      top: 50%;
      transform: translateY(-50%);
      width: 40px; height: 40px;
      font-size: 20px;
    }
    .lightbox-arrow-left { left: 18px; }
    .lightbox-arrow-right { right: 18px; }

    @media (max-width: 600px) {
      .lightbox-inner { inset: 70px 8px 70px; }
      .lightbox-arrow { width: 32px; height: 32px; }
    }
  </style>
</head>

<body>
  <div class="page">
    <header class="hero-wrapper">
      <div class="hero-shell section-animate" id="hero-shell">
        <div class="hero-photo">
          <div class="hero-photo-inner" id="hero-photo-inner"></div>
          <div class="" id="hero-tag">Save the Date</div>
        </div>

        <div class="hero-content">
          <div class="hero-eyebrow" id="hero-eyebrow">Wedding Celebration</div>
          <div class="hero-names" id="hero-names">Loading Names…</div>

          <div class="hero-subtitle" id="hero-subtitle">
            We’re so excited to celebrate this day with you.
          </div>

          <div class="hero-meta-row">
            <div class="hero-meta-pill">
              <div class="hero-meta-dot"></div>
              <span id="hero-date-text">Date to be announced</span>
            </div>

            <div class="hero-meta-pill" id="hero-location-pill" style="display:none;">
              <div class="hero-meta-dot"></div>
              <span id="hero-location-text"></span>
            </div>

            <div class="hero-meta-pill" id="hero-timezone-pill" style="display:none;">
              <div class="hero-meta-dot"></div>
              <span id="hero-timezone-text"></span>
            </div>
          </div>

          <!-- COUNTDOWN -->
          <div id="countdown-wrap" style="display:none;">
            <div class="countdown-row">
              <div class="countdown-box">
                <div class="countdown-number" id="cd-days">00</div>
                <div class="countdown-label">Days</div>
              </div>
              <div class="countdown-box">
                <div class="countdown-number" id="cd-hours">00</div>
                <div class="countdown-label">Hours</div>
              </div>
              <div class="countdown-box">
                <div class="countdown-number" id="cd-mins">00</div>
                <div class="countdown-label">Minutes</div>
              </div>
              <div class="countdown-box">
                <div class="countdown-number" id="cd-secs">00</div>
                <div class="countdown-label">Seconds</div>
              </div>
              <div class="countdown-note" id="cd-note">Countdown to our wedding</div>
            </div>
          </div>

          <div class="hero-cta-row">
            <button class="hero-btn primary" onclick="scrollToSection('section-details')">
              View Details
            </button>
            <button class="hero-btn ghost" onclick="scrollToSection('section-rsvp')">
              RSVP
            </button>
          </div>

          <div class="hero-kicker" id="hero-kicker">
            You’re invited to witness this chapter of our story.
          </div>
        </div>
      </div>
    </header>

    <main>
      <div id="loading-state" class="center-note">
        Opening your invitation
        <span class="loading-dot"></span><span class="loading-dot"></span><span class="loading-dot"></span>
      </div>
      <div id="error-state" class="center-note" style="display:none;"></div>

      <div class="sections-grid" id="sections-grid" style="display:none;">
        <!-- Left side -->
        <div class="sections-left section-animate" id="section-details">

          <!-- STORY -->
          <div class="section-block" id="section-story" style="display:none;">
            <div class="section-header">
              <div class="section-title">Our Story</div>
              <div class="section-subtitle">How it all began</div>
            </div>
            <div class="section-body">
              <div class="story-block" id="our-story"></div>
              <div class="story-block" id="proposal-story" style="margin-top:8px;"></div>

              <div class="verse-box" id="verse-box" style="display:none;">
                <div class="verse-text" id="verse-text"></div>
                <div class="verse-ref" id="verse-ref"></div>
              </div>
            </div>
          </div>

          <!-- THE DAY -->
          <div class="section-block" id="section-day">
            <div class="section-header">
              <div class="section-title">The Day</div>
              <div class="section-subtitle" id="details-subtitle">Ceremony &amp; Reception</div>
            </div>
            <div class="">
              <div id="details-date-time"></div>
              <div class="pill-row" id="pill-row-date"></div>
              <div class="venue-list" id="venue-list"></div>
            </div>
          </div>

          <!-- ENTOURAGE -->
          <div class="section-block" id="section-entourage">
            <div class="section-header">
              <div class="section-title">With Us</div>
              <div class="section-subtitle">Entourage</div>
            </div>
            <div class="section-body">

              <div class="entourage-columns">
                <div>
                  <div class="entourage-group-title">Principal Sponsors</div>
                  <div class="entourage-list" id="principal-list">—</div>
                </div>
                <div>
                  <div class="entourage-group-title">Secondary Sponsors</div>
                  <div class="entourage-list" id="secondary-list">—</div>
                </div>
              </div>

              <div class="entourage-columns" style="margin-top:16px;">
                <div>
                  <div class="entourage-group-title">Bride’s Entourage</div>
                  <div class="entourage-list" id="bridesmaids-list">—</div>
                </div>
                <div>
                  <div class="entourage-group-title">Groom’s Entourage</div>
                  <div class="entourage-list" id="groomsmen-list">—</div>
                </div>
              </div>

              <div class="entourage-columns" id="entourage-extra" style="margin-top:16px; display:none;"></div>
            </div>
          </div>

          <!-- DRESS CODE -->
          <div class="section-block" id="section-dress" style="display:none;">
            <div class="section-header">
              <div class="section-title">Dress Code</div>
              <div class="section-subtitle">Colors &amp; Mood</div>
            </div>
            <div class="section-body">
              <div class="dress-title" id="dress-title"></div>
              <div id="dress-desc"></div>
              <div class="dress-colors" id="dress-colors"></div>
            </div>
          </div>
        </div>

        <!-- Right side -->
        <div class="sections-right section-animate">

          <!-- Video -->
          <div class="section-block" id="section-video" style="display:none;">
            <div class="section-header">
              <div class="section-title">Our Story</div>
              <div class="section-subtitle">Video Highlight</div>
            </div>
            <div class="section-body">
              <div class="video-wrapper">
                <div class="video-inner">
                  <iframe
                    id="youtube-frame"
                    src=""
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    allowfullscreen
                    loading="lazy"
                  ></iframe>
                </div>
              </div>
              <div class="video-note" id="video-note">
                Press play to watch a short video we prepared for you.
              </div>
            </div>
          </div>

          <!-- Gallery -->
          <div class="section-block" id="section-gallery">
            <div class="section-header">
              <div class="section-title">Story in Frames</div>
              <div class="section-subtitle">Photo Album</div>
            </div>
            <div class="section-body">
              <div class="gallery-grid" id="gallery-grid"></div>
              <div class="gallery-more" id="gallery-more" style="display:none;">
                Tap any photo to view it in full size and slide through the album.
              </div>
            </div>
          </div>

          <!-- RSVP -->
          <div class="section-block" id="section-rsvp">
            <div class="section-header">
              <div class="section-title">RSVP</div>
              <div class="section-subtitle">We’d Love to Know</div>
            </div>
            <div class="section-body">
              <div id="rsvp-deadline-note" style="font-size:12px;color:var(--muted);margin-bottom:6px; display:none;"></div>

              <form class="rsvp-form" id="rsvp-form">
                <div>
                  <div class="field-label">Your Name <span>*</span></div>
                  <input type="text" id="rsvp-name" required placeholder="Kindly type your full name" />
                </div>

                <div>
                  <div class="field-label">Will You Be Able to Join Us?</div>
                  <select id="rsvp-status">
                    <option value="going">Happily attending</option>
                    <option value="maybe">Still confirming</option>
                    <option value="not_going">Sadly can’t make it</option>
                  </select>
                </div>

                <div>
                  <div class="field-label">Number of Guests (Including You)</div>
                  <input type="number" id="rsvp-persons" min="1" value="1" />
                </div>

                <div>
                  <div class="field-label">Message</div>
                  <textarea id="rsvp-message" placeholder="You may leave a short note or greeting here."></textarea>
                </div>

                <button type="submit" class="btn-submit">
                  Send RSVP
                </button>
              </form>

              <div class="rsvp-list" id="rsvp-list"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">
        <span id="footer-label">Thank you for being part of this day.</span>
      </div>
    </main>
  </div>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox">
    <div class="lightbox-backdrop" id="lightbox-backdrop"></div>
    <div class="lightbox-inner">
      <button class="lightbox-close" id="lightbox-close" type="button">&times;</button>
      <button class="lightbox-arrow lightbox-arrow-left" id="lightbox-prev" type="button">&#10094;</button>
      <figure class="lightbox-figure">
        <img id="lightbox-image" src="" alt="Photo" />
      </figure>
      <button class="lightbox-arrow lightbox-arrow-right" id="lightbox-next" type="button">&#10095;</button>
    </div>
  </div>

  <script>
    // -----------------------------
    // Supabase setup
    // -----------------------------
    const SUPABASE_URL = "https://minftvflekxdoiubeujy.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pbmZ0dmZsZWt4ZG9pdWJldWp5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1MTc4NjgsImV4cCI6MjA2NjA5Mzg2OH0.Aj0-ts6WzffJRrXDkTMDKjQT4t6pW_-jSUft4md0KJM";

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const inviteId = new URLSearchParams(window.location.search).get("id");

    const loadingStateEl = document.getElementById("loading-state");
    const errorStateEl = document.getElementById("error-state");
    const sectionsGridEl = document.getElementById("sections-grid");

    // Hero
    const heroNamesEl = document.getElementById("hero-names");
    const heroSubtitleEl = document.getElementById("hero-subtitle");
    const heroDateTextEl = document.getElementById("hero-date-text");
    const heroLocationTextEl = document.getElementById("hero-location-text");
    const heroLocationPillEl = document.getElementById("hero-location-pill");
    const heroTimezonePillEl = document.getElementById("hero-timezone-pill");
    const heroTimezoneTextEl = document.getElementById("hero-timezone-text");
    const heroPhotoInnerEl = document.getElementById("hero-photo-inner");
    const heroTagEl = document.getElementById("hero-tag");
    const heroKickerEl = document.getElementById("hero-kicker");
    const footerLabelEl = document.getElementById("footer-label");

    // Countdown
    const countdownWrapEl = document.getElementById("countdown-wrap");
    const cdDaysEl = document.getElementById("cd-days");
    const cdHoursEl = document.getElementById("cd-hours");
    const cdMinsEl = document.getElementById("cd-mins");
    const cdSecsEl = document.getElementById("cd-secs");
    const cdNoteEl = document.getElementById("cd-note");
    let countdownTimer = null;

    // Story
    const storySectionEl = document.getElementById("section-story");
    const ourStoryEl = document.getElementById("our-story");
    const proposalStoryEl = document.getElementById("proposal-story");
    const verseBoxEl = document.getElementById("verse-box");
    const verseTextEl = document.getElementById("verse-text");
    const verseRefEl = document.getElementById("verse-ref");

    // Details
    const detailsDateTimeEl = document.getElementById("details-date-time");
    const pillRowDateEl = document.getElementById("pill-row-date");
    const venueListEl = document.getElementById("venue-list");

    // Entourage
    const principalListEl = document.getElementById("principal-list");
    const secondaryListEl = document.getElementById("secondary-list");
    const bridesmaidsListEl = document.getElementById("bridesmaids-list");
    const groomsmenListEl = document.getElementById("groomsmen-list");
    const entourageExtraEl = document.getElementById("entourage-extra");

    // Dress
    const dressSectionEl = document.getElementById("section-dress");
    const dressTitleEl = document.getElementById("dress-title");
    const dressDescEl = document.getElementById("dress-desc");
    const dressColorsEl = document.getElementById("dress-colors");

    // Gallery
    const galleryGridEl = document.getElementById("gallery-grid");
    const galleryMoreEl = document.getElementById("gallery-more");

    // Video
    const videoSectionEl = document.getElementById("section-video");
    const videoFrameEl = document.getElementById("youtube-frame");

    // RSVP
    const rsvpDeadlineNoteEl = document.getElementById("rsvp-deadline-note");
    const rsvpFormEl = document.getElementById("rsvp-form");
    const rsvpNameEl = document.getElementById("rsvp-name");
    const rsvpStatusEl = document.getElementById("rsvp-status");
    const rsvpPersonsEl = document.getElementById("rsvp-persons");
    const rsvpMessageEl = document.getElementById("rsvp-message");
    const rsvpListEl = document.getElementById("rsvp-list");

    // Lightbox
    const lightboxEl = document.getElementById("lightbox");
    const lightboxBackdropEl = document.getElementById("lightbox-backdrop");
    const lightboxImageEl = document.getElementById("lightbox-image");
    const lightboxCloseEl = document.getElementById("lightbox-close");
    const lightboxPrevEl = document.getElementById("lightbox-prev");
    const lightboxNextEl = document.getElementById("lightbox-next");

    let galleryPhotos = [];
    let currentPhotoIndex = 0;

    // Hero slideshow
    let heroSlides = [];
    let heroSlideIndex = 0;
    let heroSlideTimer = null;

    const hasText = (s) => typeof s === "string" && s.trim().length > 0;

    function setLoading(isLoading) {
      if (isLoading) {
        loadingStateEl.style.display = "block";
        errorStateEl.style.display = "none";
        sectionsGridEl.style.display = "none";
      } else {
        loadingStateEl.style.display = "none";
      }
    }

    function showError(message) {
      errorStateEl.textContent = message;
      errorStateEl.style.display = "block";
      sectionsGridEl.style.display = "none";
      loadingStateEl.style.display = "none";
    }

    function scrollToSection(id) {
      const el = document.getElementById(id);
      if (!el) return;
      const rect = el.getBoundingClientRect();
      const offset = window.scrollY + rect.top - 80;
      window.scrollTo({ top: offset, behavior: "smooth" });
    }

    function formatDate(dateStr) {
      if (!dateStr) return "";
      const d = new Date(dateStr + "T00:00:00");
      if (!isNaN(d.getTime())) {
        return d.toLocaleDateString(undefined, {
          year: "numeric",
          month: "long",
          day: "numeric"
        });
      }
      return dateStr;
    }

    function formatDateShort(dateStr) {
      if (!dateStr) return "";
      const d = new Date(dateStr + "T00:00:00");
      if (!isNaN(d.getTime())) {
        return d.toLocaleDateString(undefined, {
          year: "numeric",
          month: "short",
          day: "numeric"
        });
      }
      return dateStr;
    }

    function formatTime(timeStr) {
      if (!timeStr) return "";
      const match = /^(\d{1,2}):(\d{2})/.exec(timeStr);
      if (!match) return timeStr;
      let hour = parseInt(match[1], 10);
      const min = match[2];
      const suffix = hour >= 12 ? "PM" : "AM";
      if (hour === 0) hour = 12;
      else if (hour > 12) hour -= 12;
      return `${hour}:${min} ${suffix}`;
    }

    function prettyRSVPStatus(status) {
      switch (status) {
        case "going": return "Will attend";
        case "maybe": return "Still confirming";
        case "not_going": return "Cannot attend";
        case "attending": return "Will attend";
        case "not_attending": return "Cannot attend";
        default: return "Responded";
      }
    }

    function formatTimeAgo(ts) {
      if (!ts) return "";
      const t = new Date(ts).getTime();
      if (!t) return "";
      const diff = Date.now() - t;
      const m = 60000;
      const h = 60 * m;
      const d = 24 * h;
      if (diff < m) return "Just now";
      if (diff < h) {
        const mins = Math.floor(diff / m);
        return `${mins} min${mins > 1 ? "s" : ""} ago`;
      }
      if (diff < d) {
        const hrs = Math.floor(diff / h);
        return `${hrs} hour${hrs > 1 ? "s" : ""} ago`;
      }
      const days = Math.floor(diff / d);
      if (days === 1) return "Yesterday";
      return `${days} days ago`;
    }

    function getYouTubeEmbedUrl(input) {
      if (!input) return "";
      let url = String(input).trim();

      if (url.includes("youtube.com/embed") || url.includes("youtube-nocookie.com/embed")) {
        return url;
      }
      const match = url.match(/(?:v=|youtu\.be\/|\/shorts\/)([A-Za-z0-9_-]{6,})/);
      const id = match ? match[1] : null;
      if (!id) return "";
      return `https://www.youtube.com/embed/${id}?rel=0`;
    }

    function parsePhotos(row) {
      if (Array.isArray(row.media_photos)) return row.media_photos.filter(Boolean);
      if (hasText(row.media_photos)) {
        return row.media_photos.split(",").map(s => s.trim()).filter(Boolean);
      }
      return [];
    }

    function setHeroBackground(url, animate = true) {
      if (!heroPhotoInnerEl || !url) return;
      if (animate) {
        heroPhotoInnerEl.classList.add("fading");
        setTimeout(() => {
          heroPhotoInnerEl.style.backgroundImage = `url("${url}")`;
          heroPhotoInnerEl.classList.add("has-image");
          void heroPhotoInnerEl.offsetHeight;
          heroPhotoInnerEl.classList.remove("fading");
        }, 260);
      } else {
        heroPhotoInnerEl.style.backgroundImage = `url("${url}")`;
        heroPhotoInnerEl.classList.add("has-image");
        heroPhotoInnerEl.classList.remove("fading");
      }
    }

    function startHeroSlideshow() {
      if (heroSlideTimer) {
        clearInterval(heroSlideTimer);
        heroSlideTimer = null;
      }
      if (!heroSlides || heroSlides.length < 2) return;

      heroSlideIndex = 0;
      heroSlideTimer = setInterval(() => {
        if (!heroSlides.length) return;
        heroSlideIndex = (heroSlideIndex + 1) % heroSlides.length;
        setHeroBackground(heroSlides[heroSlideIndex], true);
      }, 3000);
    }

    function setupCountdown(weddingDate, weddingTime) {
      if (!hasText(weddingDate)) {
        countdownWrapEl.style.display = "none";
        return;
      }

      let targetStr = weddingDate.trim();
      targetStr += hasText(weddingTime) ? ("T" + weddingTime.trim()) : "T00:00:00";
      const target = new Date(targetStr);

      if (isNaN(target.getTime())) {
        countdownWrapEl.style.display = "none";
        return;
      }

      countdownWrapEl.style.display = "block";
      const tick = () => {
        const now = new Date();
        let diff = target.getTime() - now.getTime();

        if (diff <= 0) {
          clearInterval(countdownTimer);
          cdDaysEl.textContent = "00";
          cdHoursEl.textContent = "00";
          cdMinsEl.textContent = "00";
          cdSecsEl.textContent = "00";
          cdNoteEl.textContent = "Today is the day!";
          return;
        }

        const dayMs = 1000 * 60 * 60 * 24;
        const hourMs = 1000 * 60 * 60;
        const minMs = 1000 * 60;

        const days = Math.floor(diff / dayMs);
        diff -= days * dayMs;
        const hours = Math.floor(diff / hourMs);
        diff -= hours * hourMs;
        const mins = Math.floor(diff / minMs);
        diff -= mins * minMs;
        const secs = Math.floor(diff / 1000);

        cdDaysEl.textContent = String(days).padStart(2, "0");
        cdHoursEl.textContent = String(hours).padStart(2, "0");
        cdMinsEl.textContent = String(mins).padStart(2, "0");
        cdSecsEl.textContent = String(secs).padStart(2, "0");
      };

      tick();
      countdownTimer = setInterval(tick, 1000);
    }

    function addEntourageBlock(title, value) {
      if (!hasText(value)) return;
      const wrap = document.createElement("div");
      wrap.innerHTML = `
        <div class="entourage-group-title">${title}</div>
        <div class="entourage-list">${value}</div>
      `;
      return wrap;
    }

    function renderInvite(row) {
      const d = row || {};
      const photos = parsePhotos(d);

      const bride = d.bride || "";
      const groom = d.groom || "";
      const coupleNames = bride && groom
        ? `${bride} & ${groom}`
        : (bride || groom || "Our Wedding");

      heroNamesEl.textContent = coupleNames;
      document.title = coupleNames || "Wedding Invitation";

      const tagline = d.tagline || "";
      heroSubtitleEl.innerHTML = hasText(tagline)
        ? `<em>${tagline}</em>`
        : "We are joyfully inviting you to celebrate this special day with us.";

      const prettyDate = formatDate(d.wedding_date);
      const prettyTime = formatTime(d.wedding_time);

      heroDateTextEl.textContent = prettyDate
        ? (prettyTime ? `${prettyDate} · ${prettyTime}` : prettyDate)
        : "Date to be announced";

      const mainVenue = d.main_venue_label || d.ceremony_name || "";
      if (hasText(mainVenue)) {
        heroLocationTextEl.textContent = mainVenue;
        heroLocationPillEl.style.display = "inline-flex";
      } else {
        heroLocationPillEl.style.display = "none";
      }

      if (hasText(d.timezone)) {
        heroTimezoneTextEl.textContent = d.timezone;
        heroTimezonePillEl.style.display = "inline-flex";
      } else {
        heroTimezonePillEl.style.display = "none";
      }

      const heroImage = (photos.length ? photos[0] : "");
      heroSlides = [];
      if (heroImage) heroSlides.push(heroImage);
      heroSlides.push(...photos.filter((url) => url && url !== heroImage));

      if (heroSlides.length > 0) {
        setHeroBackground(heroSlides[0], false);
        startHeroSlideshow();
      }

      heroTagEl.textContent = prettyDate || "Save the Date";

      const rsvpNote = d.rsvp_note || "";
      heroKickerEl.textContent = rsvpNote || "You’re invited to witness this chapter of our story.";
      footerLabelEl.textContent = coupleNames ? `With love, ${coupleNames}` : "Thank you for being with us.";

      setupCountdown(d.wedding_date, d.wedding_time);

      const hasStory = hasText(d.our_story) || hasText(d.proposal_story) || hasText(d.verse_text) || hasText(d.verse_reference);
      if (hasStory) {
        storySectionEl.style.display = "block";
        ourStoryEl.textContent = d.our_story || "";
        proposalStoryEl.textContent = d.proposal_story || "";

        if (hasText(d.verse_text) || hasText(d.verse_reference)) {
          verseBoxEl.style.display = "block";
          verseTextEl.textContent = d.verse_text || "";
          verseRefEl.textContent = d.verse_reference || "";
        } else {
          verseBoxEl.style.display = "none";
        }
      } else {
        storySectionEl.style.display = "none";
      }

      const detailsLines = [];
      if (prettyDate) detailsLines.push(prettyDate);
      if (prettyTime) detailsLines.push(prettyTime);
      detailsDateTimeEl.textContent = detailsLines.join(" · ");

      pillRowDateEl.innerHTML = "";
      if (hasText(d.timezone)) {
        const pill = document.createElement("div");
        pill.className = "pill";
        pill.textContent = d.timezone;
        pillRowDateEl.appendChild(pill);
      }
      if (hasText(d.event_type)) {
        const pill = document.createElement("div");
        pill.className = "pill";
        pill.textContent = d.event_type;
        pillRowDateEl.appendChild(pill);
      }

      venueListEl.innerHTML = "";
      const ceremony = {
        label: "Ceremony",
        name: d.ceremony_name,
        address: d.ceremony_address,
        notes: d.ceremony_notes,
        map: d.ceremony_map_url
      };
      const reception = {
        label: "Reception",
        name: d.reception_name,
        address: d.reception_address,
        notes: d.reception_notes,
        map: d.reception_map_url
      };

      [ceremony, reception].forEach((v) => {
        if (!hasText(v.name) && !hasText(v.address) && !hasText(v.notes)) return;

        const item = document.createElement("div");
        item.className = "venue-item";

        item.innerHTML = `
          <div class="venue-label">${v.label}</div>
          ${hasText(v.name) ? `<div class="venue-name">${v.name}</div>` : ""}
          ${hasText(v.address) ? `<div class="venue-address">${v.address}</div>` : ""}
          ${hasText(v.notes) ? `<div class="venue-notes">${v.notes}</div>` : ""}
          ${hasText(v.map) ? `<a class="venue-link" href="${v.map}" target="_blank" rel="noopener noreferrer"><span>Open in Maps</span></a>` : ""}
        `;

        venueListEl.appendChild(item);
      });

      principalListEl.textContent = d.principal_sponsors || "To follow";
      secondaryListEl.textContent = d.secondary_sponsors || "To follow";
      bridesmaidsListEl.textContent = d.maid_of_honor_block || "To follow";
      groomsmenListEl.textContent = d.best_man_block || "To follow";

      entourageExtraEl.innerHTML = "";
      const extraGroups = [
        ["Parents of the Bride", d.parents_bride],
        ["Parents of the Groom", d.parents_groom],
        ["Flower Girls", d.flower_girls],
        ["Ring Bearer", d.ring_bearer],
        ["Other Roles", d.other_roles],
      ];

      let hasExtra = false;
      extraGroups.forEach(([title, val]) => {
        const block = addEntourageBlock(title, val);
        if (block) {
          hasExtra = true;
          const col = document.createElement("div");
          col.appendChild(block);
          entourageExtraEl.appendChild(col);
        }
      });

      entourageExtraEl.style.display = hasExtra ? "grid" : "none";
      if (hasExtra) entourageExtraEl.className = "entourage-columns";

      const hasDress =
        hasText(d.dress_title) ||
        hasText(d.dress_description) ||
        hasText(d.dress_color1) ||
        hasText(d.dress_color2) ||
        hasText(d.dress_color3);

      if (hasDress) {
        dressSectionEl.style.display = "block";
        dressTitleEl.textContent = d.dress_title || "";
        dressDescEl.textContent =
          d.dress_description || "We’ll be happy to see you in your most comfortable semi-formal outfit.";

        dressColorsEl.innerHTML = "";
        [d.dress_color1, d.dress_color2, d.dress_color3]
          .filter(hasText)
          .forEach((c) => {
            const dot = document.createElement("div");
            dot.className = "color-dot";
            dot.style.background = c;
            dressColorsEl.appendChild(dot);
          });
      } else {
        dressSectionEl.style.display = "none";
      }

      if (hasText(d.media_video_url)) {
        const embed = getYouTubeEmbedUrl(d.media_video_url);
        if (embed) {
          videoFrameEl.src = embed;
          videoSectionEl.style.display = "block";
        } else {
          videoSectionEl.style.display = "none";
        }
      } else {
        videoSectionEl.style.display = "none";
      }

      galleryPhotos = photos.slice();
      galleryGridEl.innerHTML = "";

      if (galleryPhotos.length) {
        const maxToShow = Math.min(galleryPhotos.length, 6);
        for (let i = 0; i < maxToShow; i++) {
          const url = galleryPhotos[i];
          const item = document.createElement("div");
          item.className = "gallery-item";
          const img = document.createElement("img");
          img.src = url;
          img.alt = "Wedding photo";
          img.loading = "lazy";
          item.appendChild(img);
          item.addEventListener("click", () => openLightbox(i));
          galleryGridEl.appendChild(item);
        }
        galleryMoreEl.style.display = "block";
      } else {
        galleryGridEl.innerHTML =
          "<div style='font-size:13px;color:var(--muted);'>Photos will be added soon.</div>";
        galleryMoreEl.style.display = "none";
      }

      if (hasText(d.rsvp_deadline)) {
        rsvpDeadlineNoteEl.style.display = "block";
        rsvpDeadlineNoteEl.textContent = `Please RSVP on or before ${formatDateShort(d.rsvp_deadline)}.`;
      } else {
        rsvpDeadlineNoteEl.style.display = "none";
      }

      sectionsGridEl.style.display = "grid";
    }

    function renderRSVPList(rsvps) {
      rsvpListEl.innerHTML = "";
      if (!Array.isArray(rsvps) || rsvps.length === 0) {
        rsvpListEl.innerHTML =
          "<div style='font-size:12px;color:var(--muted);padding-top:4px;'>No responses yet. Be the first to RSVP.</div>";
        return;
      }

      rsvps.forEach((row) => {
        const item = document.createElement("div");
        item.className = "rsvp-item";

        const nameRow = document.createElement("div");
        nameRow.className = "rsvp-name-row";

        const nameEl = document.createElement("div");
        nameEl.className = "rsvp-name";
        nameEl.textContent = row.name || "Guest";

        const statusEl = document.createElement("div");
        statusEl.className = "rsvp-status";
        statusEl.textContent = prettyRSVPStatus(row.status);

        nameRow.appendChild(nameEl);
        nameRow.appendChild(statusEl);
        item.appendChild(nameRow);

        const meta = document.createElement("div");
        meta.className = "rsvp-meta";
        const parts = [];
        if (row.persons) parts.push(`${row.persons} guest${row.persons > 1 ? "s" : ""}`);
        if (row.created_at) parts.push(formatTimeAgo(row.created_at));
        meta.textContent = parts.join(" · ");
        item.appendChild(meta);

        if (row.message) {
          const msg = document.createElement("div");
          msg.className = "rsvp-message";
          msg.textContent = row.message;
          item.appendChild(msg);
        }

        rsvpListEl.appendChild(item);
      });
    }

    async function loadInviteAndRSVPs() {
      if (!inviteId) {
        showError("Missing invitation ID in the link.");
        return;
      }
      setLoading(true);

      try {
        const { data: inviteRow, error: inviteError } = await supabase
          .from("invites-new")
          .select("*")
          .eq("id", inviteId)
          .maybeSingle();

        if (inviteError) {
          console.error("Error loading invite:", inviteError);
          showError("We couldn’t open this invitation at the moment.");
          return;
        }

        if (!inviteRow) {
          showError("Invitation not found. Kindly check with your host.");
          return;
        }

        renderInvite(inviteRow);

        const { data: rsvps, error: rsvpError } = await supabase
          .from("rsvps")
          .select("id, name, status, persons, message, created_at")
          .eq("invite_id", inviteId)
          .order("created_at", { ascending: true });

        if (rsvpError) {
          console.error("Error loading RSVPs:", rsvpError);
          renderRSVPList([]);
        } else {
          renderRSVPList(rsvps || []);
        }

        setLoading(false);
      } catch (err) {
        console.error(err);
        showError("Something went wrong opening this invitation.");
      }
    }

    async function submitRSVP(event) {
      event.preventDefault();
      if (!inviteId) return;

      const name = (rsvpNameEl.value || "").trim();
      const status = rsvpStatusEl.value || "going";
      const persons = parseInt(rsvpPersonsEl.value || "1", 10) || 1;
      const message = (rsvpMessageEl.value || "").trim();

      if (!name) { rsvpNameEl.focus(); return; }

      try {
        const payload = { invite_id: inviteId, name, status, persons, message };

        const { data, error } = await supabase
          .from("rsvps")
          .insert(payload)
          .select("id, name, status, persons, message, created_at")
          .single();

        if (error) {
          console.error("Error saving RSVP:", error);
          Swal.fire({ icon: "error", title: "Oops", text: "We couldn’t save your RSVP. Please try again." });
          return;
        }

        rsvpPersonsEl.value = "1";
        rsvpMessageEl.value = "";

        const { data: rsvpsNew } = await supabase
          .from("rsvps")
          .select("id, name, status, persons, message, created_at")
          .eq("invite_id", inviteId)
          .order("created_at", { ascending: true });

        renderRSVPList(rsvpsNew || []);

        Swal.fire({ icon: "success", title: "Thank you!", text: "Your RSVP has been recorded." });
      } catch (err) {
        console.error(err);
        Swal.fire({ icon: "error", title: "Oops", text: "We encountered an error. Please try again." });
      }
    }

    // Lightbox
    function openLightbox(index) {
      if (!galleryPhotos.length) return;
      currentPhotoIndex = index;
      updateLightboxImage();
      lightboxEl.style.display = "block";
      document.body.style.overflow = "hidden";
    }
    function closeLightbox() {
      lightboxEl.style.display = "none";
      document.body.style.overflow = "";
    }
    function updateLightboxImage() {
      if (!galleryPhotos.length) return;
      lightboxImageEl.src = galleryPhotos[currentPhotoIndex];
    }
    function showNextPhoto() {
      if (!galleryPhotos.length) return;
      currentPhotoIndex = (currentPhotoIndex + 1) % galleryPhotos.length;
      updateLightboxImage();
    }
    function showPrevPhoto() {
      if (!galleryPhotos.length) return;
      currentPhotoIndex = (currentPhotoIndex - 1 + galleryPhotos.length) % galleryPhotos.length;
      updateLightboxImage();
    }

    // Scroll animations
    function initScrollAnimations() {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("in-view");
              observer.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.15 }
      );
      document.querySelectorAll(".section-animate").forEach((el) => observer.observe(el));
    }

    document.addEventListener("DOMContentLoaded", () => {
      rsvpFormEl.addEventListener("submit", submitRSVP);
      initScrollAnimations();
      loadInviteAndRSVPs();

      lightboxCloseEl.addEventListener("click", closeLightbox);
      lightboxBackdropEl.addEventListener("click", closeLightbox);
      lightboxNextEl.addEventListener("click", showNextPhoto);
      lightboxPrevEl.addEventListener("click", showPrevPhoto);

      document.addEventListener("keydown", (e) => {
        if (lightboxEl.style.display === "block") {
          if (e.key === "Escape") closeLightbox();
          if (e.key === "ArrowRight") showNextPhoto();
          if (e.key === "ArrowLeft") showPrevPhoto();
        }
      });
    });
  </script>
</body>
</html>
