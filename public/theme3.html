<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Midnight Bloom ‚Äì Wedding Invitation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts (totally different vibe) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600&family=Great+Vibes&display=swap"
    rel="stylesheet"
  />

  <!-- Supabase + SweetAlert2 -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root{
      --bg: #070a10;
      --bg-soft: #0e1420;
      --glass: rgba(255,255,255,0.06);
      --glass-strong: rgba(255,255,255,0.09);
      --line: rgba(255,255,255,0.10);

      --gold: #d6b36c;
      --gold-soft: #f1d9a0;
      --blue: #7aa9ff;
      --ink: #eef2ff;
      --ink-muted: #aab3c7;
      --white: #ffffff;

      --script: "Great Vibes", cursive;
      --serif: "Cinzel", serif;
      --sans: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;

      --radius-xl: 26px;
      --radius-lg: 18px;

      --trans: 1.1s;
      --ease: cubic-bezier(0.215, 0.61, 0.355, 1);

      /* ‚úÖ topbar height */
      --nav-h: 70px;
    }

    *{ box-sizing: border-box; }
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 10% -10%, #111827 0%, var(--bg) 45%, #030509 100%);
      color: var(--ink);
      font-family: var(--sans);
      line-height: 1.7;
      overflow-x: hidden;
    }
    a{ color: inherit; }

    .hidden{ display:none !important; }

    /* LOADING */
    .loading-overlay{
      position: fixed; inset:0; z-index:999;
      background: radial-gradient(800px 600px at 50% 0%, #111827, var(--bg));
      display:flex; flex-direction:column; justify-content:center; align-items:center;
      color: var(--ink);
      font-family: var(--serif);
      letter-spacing: .35em;
      text-transform: uppercase;
      font-size: .85rem;
    }
    .loading-orb{
      width: 46px; height: 46px; border-radius:999px;
      background: conic-gradient(from 0deg, var(--gold), transparent, var(--blue), transparent, var(--gold));
      mask: radial-gradient(circle, transparent 55%, black 56%);
      -webkit-mask: radial-gradient(circle, transparent 55%, black 56%);
      animation: spin 1.2s linear infinite;
      margin-bottom: 16px;
      box-shadow: 0 0 35px rgba(214,179,108,.45);
    }
    @keyframes spin { to{ transform: rotate(360deg); } }

    /* ANIMATIONS */
    .anim-up{
      opacity:0; transform: translateY(26px);
      transition: opacity var(--trans) var(--ease), transform var(--trans) var(--ease);
    }
    .anim-fade{
      opacity:0; transition:opacity 1.6s ease;
    }
    .visible{ opacity:1; transform:none; }

    .delay-100{ transition-delay:.1s; }
    .delay-200{ transition-delay:.2s; }
    .delay-300{ transition-delay:.3s; }

    /* ================================
       TOPBAR (Theme1-style, Midnight Bloom)
    ================================ */
    .topbar-bloom{
      position: fixed;
      top:0; left:0; right:0;
      height: var(--nav-h);
      z-index: 1200;

      display:flex; align-items:center; justify-content:space-between;
      padding: 0 14px;

      background: rgba(7,10,16,0.75);
      border-bottom: 1px solid var(--line);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .topbar-brand{
      display:flex; align-items:center; gap:10px;
      min-width:0;
    }

    .topbar-avatar{
      width:42px; height:42px; border-radius:999px; overflow:hidden;
      background: rgba(214,179,108,0.12);
      border: 1px solid rgba(214,179,108,0.35);
      display:grid; place-items:center;
      font-family: var(--serif);
      font-weight:800;
      font-size:12px;
      color: var(--gold-soft);
      flex-shrink:0;
    }
    .topbar-avatar img{
      width:100%; height:100%; object-fit:cover; display:none;
    }

    .topbar-title{
      font-family: var(--serif);
      font-size: 15px;
      letter-spacing:.12em;
      text-transform: uppercase;
      color: var(--white);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:45vw;
    }

    .topbar-links{
      display:flex; align-items:center; gap:4px;
    }

    .topbar-link{
      padding:8px 12px;
      border-radius:999px;
      border:1px solid transparent;
      background: transparent;
      color: var(--ink-muted);
      font-family: var(--sans);
      font-size: 12.5px;
      font-weight: 700;
      letter-spacing:.12em;
      text-transform: uppercase;
      cursor:pointer;
      transition: .18s ease;
      white-space:nowrap;
    }
    .topbar-link:hover{
      color: var(--white);
      background: rgba(255,255,255,0.06);
      border-color: var(--line);
    }
    .topbar-link.active{
      color: var(--white);
      background: rgba(214,179,108,0.10);
      border-color: rgba(214,179,108,0.45);
      box-shadow: 0 0 18px rgba(214,179,108,0.2);
    }

    /* hamburger */
    .topbar-ham{
      display:none;
      width:44px; height:44px;
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,0.05);
      align-items:center; justify-content:center;
      cursor:pointer;
    }
    .topbar-ham span{
      display:block; width:18px; height:2px;
      background: var(--white);
      margin:3px 0; border-radius:2px;
    }

    /* mobile dropdown */
    .topbar-mob{
      position: fixed;
      top: var(--nav-h);
      left:0; right:0;
      z-index:1199;
      background: rgba(7,10,16,0.92);
      border-bottom: 1px solid var(--line);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);

      padding:10px;
      transform: translateY(-8px);
      opacity:0; pointer-events:none;
      transition:.2s ease;
    }
    .topbar-mob.open{
      transform: translateY(0);
      opacity:1; pointer-events:auto;
    }
    .topbar-mob .topbar-link{
      width:100%;
      border-radius:12px;
      text-align:center;
      padding:10px 12px;
      margin:2px 0;
    }

    /* responsive */
    @media(max-width: 900px){
      .topbar-links{ display:none; }
      .topbar-ham{ display:flex; }
    }

    /* HERO */
    header.hero{
      position: relative;
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: calc(var(--nav-h) + 30px) 14px 40px; /* ‚úÖ adjusted for topbar */
      overflow: hidden;
    }
    .hero-bg{
      position:absolute; inset:-2%;
      background-position:center;
      background-size:cover;
      filter: saturate(1.06) contrast(1.04);
      opacity:0; transition: opacity 2.2s ease, transform 9.5s ease;
      transform: scale(1.06);
    }
    .hero-bg.active{ opacity:1; transform: scale(1.12); }

    .hero-vignette{
      position:absolute; inset:0;
      background:
        radial-gradient(900px 600px at 50% -10%, rgba(0,0,0,0.25), transparent 60%),
        radial-gradient(900px 600px at 50% 110%, rgba(0,0,0,0.65), transparent 65%),
        linear-gradient(to bottom, rgba(7,10,16,.25), rgba(7,10,16,.9));
      z-index:1;
    }

    .hero-frame{
      position:relative; z-index:2;
      width: min(980px, 94vw);
      background: var(--glass);
      border: 1px solid var(--line);
      border-radius: 32px;
      padding: clamp(22px, 5vw, 50px);
      text-align:center;
      box-shadow: 0 25px 70px rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .hero-chip{
      display:inline-flex; align-items:center; gap:8px;
      padding: 7px 14px;
      border-radius:999px;
      background: rgba(0,0,0,.35);
      border:1px solid var(--line);
      font-size:.72rem;
      letter-spacing:.28em;
      text-transform: uppercase;
      color: var(--ink-muted);
      margin-bottom: 10px;
    }
    .hero-chip .dot{
      width:7px; height:7px; border-radius:999px; background: var(--gold);
      box-shadow: 0 0 8px rgba(214,179,108,.8);
    }

    .hero-names{
      font-family: var(--serif);
      font-size: clamp(2.4rem, 6vw, 4.8rem);
      line-height: 1.12;
      margin: 8px 0 6px;
      letter-spacing: .04em;
    }
    .hero-names span{ display:block; }
    .hero-amp{
      font-family: var(--script);
      font-weight:400;
      font-size: clamp(2.3rem, 5vw, 4rem);
      color: var(--gold);
      margin: 2px 0;
      text-shadow: 0 0 18px rgba(214,179,108,.6);
    }

    .hero-meta{
      margin-top: 12px;
      display:flex; flex-wrap:wrap;
      justify-content:center; gap:10px;
      font-size:.95rem;
      color: var(--ink-muted);
      letter-spacing:.08em;
    }
    .hero-meta-pill{
      padding: 8px 14px;
      background: rgba(0,0,0,.35);
      border:1px solid var(--line);
      border-radius: 999px;
    }
    .hero-venue{
      font-family: var(--serif);
      text-transform: uppercase;
      letter-spacing: .18em;
      font-size:.8rem;
      margin-top: 10px;
      color: var(--gold-soft);
    }

    /* COUNTDOWN FLOAT CARD */
    .countdown-container{
      width: min(980px, 94vw);
      margin: -70px auto 50px;
      position: relative;
      z-index: 3;
      background: linear-gradient(145deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border:1px solid var(--line);
      border-radius: var(--radius-xl);
      padding: 22px 18px;
      display:flex; flex-direction:column; align-items:center; gap:10px;
      box-shadow: 0 20px 55px rgba(0,0,0,.5);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      text-align:center;
    }
    .countdown-title{
      font-family: var(--serif);
      letter-spacing:.24em; text-transform: uppercase;
      font-size:.75rem; color: var(--ink-muted);
    }
    .count-grid{
      display:grid; grid-template-columns: repeat(4,1fr);
      gap:10px; width:100%; max-width:720px;
    }
    .count-item{
      background: var(--glass-strong);
      border:1px solid var(--line);
      border-radius: 16px;
      padding: 12px 8px;
      display:grid; gap:2px;
    }
    .count-num{
      font-family: var(--serif);
      font-size: clamp(1.4rem, 3.3vw, 2.1rem);
      color: var(--white);
      text-shadow: 0 0 12px rgba(122,169,255,.4);
    }
    .count-label{
      font-size:.68rem; text-transform: uppercase; letter-spacing:.18em;
      color: var(--ink-muted);
    }
    @media (max-width:560px){
      .count-grid{ grid-template-columns: repeat(2,1fr); }
    }

    /* SECTIONS */
    section{
      max-width: 1000px;
      margin: 0 auto;
      padding: 70px 16px;
      scroll-margin-top: calc(var(--nav-h) + 14px);
    }

    .sec-head{
      text-align:center; margin-bottom: 22px;
    }
    .sec-kicker{
      font-family: var(--sans);
      text-transform: uppercase;
      letter-spacing: .30em;
      font-size: .72rem;
      color: var(--ink-muted);
    }
    .sec-title{
      font-family: var(--serif);
      font-size: clamp(1.9rem, 4.2vw, 2.8rem);
      margin: 8px 0 6px;
      letter-spacing: .08em;
      text-transform: uppercase;
      color: var(--white);
    }
    .sec-script{
      font-family: var(--script);
      font-size: clamp(1.4rem, 3.6vw, 2rem);
      color: var(--gold);
      margin-top: 4px;
    }
    .divider{
      margin: 16px auto 0;
      width: 220px;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--gold), transparent);
      opacity:.8;
      position: relative;
    }
    .divider::after{
      content:"‚ú¶";
      position:absolute; left:50%; top:-10px; transform:translateX(-50%);
      color: var(--gold-soft); font-size: 1rem;
      text-shadow: 0 0 10px rgba(214,179,108,.7);
    }

    .panel{
      background: var(--glass);
      border:1px solid var(--line);
      border-radius: var(--radius-xl);
      padding: clamp(18px, 3.5vw, 30px);
      box-shadow: 0 14px 40px rgba(0,0,0,.45);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    /* STORY */
    .story-text{
      text-align:center;
      max-width: 760px;
      margin: 0 auto 18px;
      color: var(--ink-muted);
      font-size: 1.05rem;
      white-space: pre-line;
    }
    .verse-box{
      margin: 26px auto 0;
      max-width: 680px;
      padding: 22px 24px;
      border-radius: 18px;
      background: rgba(214,179,108,0.08);
      border: 1px solid rgba(214,179,108,0.35);
      text-align:center;
    }
    .verse-text{
      font-family: var(--serif);
      font-style: italic;
      font-size: 1.15rem;
      color: var(--white);
      white-space: pre-line;
    }
    .verse-ref{
      margin-top:10px;
      font-size:.78rem; letter-spacing:.18em; text-transform: uppercase;
      color: var(--ink-muted);
    }

    /* EVENTS */
    .events-grid{
      display:grid; grid-template-columns: 1fr 1fr; gap:16px;
    }
    @media (max-width:760px){
      .events-grid{ grid-template-columns:1fr; }
    }

    .event-card{
      position:relative;
      padding: 18px;
      border-radius: 22px;
      background: linear-gradient(160deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border:1px solid var(--line);
      overflow:hidden;
      text-align:center;
    }
    .event-badge{
      position:absolute; top:14px; left:14px;
      font-size:.68rem; letter-spacing:.2em; text-transform: uppercase;
      background: rgba(0,0,0,.5);
      border:1px solid var(--line);
      padding:6px 10px; border-radius:999px;
      color: var(--gold-soft);
    }
    .event-photo{
      width:100%; aspect-ratio: 16/9;
      border-radius: 14px;
      overflow:hidden; background:#0b1020;
      border:1px solid var(--line);
      margin-bottom:12px;
      display:grid; place-items:center;
    }
    .event-photo img{
      width:100%; height:100%; object-fit:cover; display:none;
      transform: scale(1.02);
    }
    .event-photo-placeholder{
      color: var(--ink-muted);
      letter-spacing:.2em; font-size:.75rem; text-transform: uppercase; font-weight:700;
    }

    .event-icon{
      font-size: 1.9rem; margin-top:4px;
      filter: drop-shadow(0 0 10px rgba(214,179,108,.35));
    }
    .event-name{
      font-family: var(--serif);
      font-size: 1.45rem;
      letter-spacing:.12em;
      text-transform: uppercase;
      margin: 8px 0 6px;
      color: var(--white);
    }
    .event-detail{
      color: var(--ink-muted);
      font-size: .98rem;
      white-space: pre-line;
    }
    .btn-outline{
      display:inline-flex; align-items:center; gap:8px;
      margin-top: 12px;
      padding: 10px 16px;
      border-radius: 999px;
      border:1px solid rgba(214,179,108,.55);
      color: var(--gold-soft);
      text-decoration:none;
      text-transform: uppercase;
      letter-spacing:.18em;
      font-size:.72rem;
      background: rgba(214,179,108,0.06);
      transition: transform .15s ease, background .2s ease;
    }
    .btn-outline:hover{
      transform: translateY(-1px);
      background: rgba(214,179,108,0.14);
    }

    /* GALLERY */
    .gallery-grid{
      margin-top: 8px;
      display:grid;
      grid-template-columns: repeat(auto-fill,minmax(170px,1fr));
      gap: 10px;
    }
    .gallery-item{
      width:100%; aspect-ratio: 1/1.1;
      object-fit: cover;
      border-radius: 16px;
      border:1px solid var(--line);
      cursor:pointer;
      transition: transform .2s ease, filter .2s ease, box-shadow .2s ease;
      filter: saturate(1.05);
      background:#0b1020;
    }
    .gallery-item:hover{
      transform: translateY(-2px) scale(1.01);
      filter: brightness(.96);
      box-shadow: 0 10px 30px rgba(0,0,0,.6);
    }

    /* SPONSORS */
    .sponsor-group{
      text-align:center;
      margin: 0 auto 18px;
      max-width: 820px;
      padding: 14px 12px;
      border-radius: 16px;
      background: var(--glass);
      border:1px dashed var(--line);
    }
    .sponsor-title{
      font-family: var(--sans);
      font-weight:800;
      letter-spacing:.26em; text-transform: uppercase;
      font-size:.72rem;
      color: var(--gold-soft);
      margin-bottom: 8px;
    }
    .sponsor-names{
      font-family: var(--serif);
      font-size: 1.10rem;
      color: var(--ink);
      line-height: 1.65;
      white-space: pre-line;
    }

    /* DRESS CODE */
    .dress-code-box{
      text-align:center;
      border-radius: 24px;
      padding: 28px 18px;
      background: linear-gradient(160deg, rgba(122,169,255,0.08), rgba(214,179,108,0.06));
      border:1px solid var(--line);
    }
    .dress-title{
      font-family: var(--serif);
      letter-spacing:.2em;
      text-transform: uppercase;
      font-size: 1.1rem;
      margin-top: 6px;
      color: var(--white);
    }
    .dress-desc{
      color: var(--ink-muted);
      font-size: .97rem;
      max-width: 680px;
      margin: 8px auto 0;
      white-space: pre-line;
    }
    .palette{
      display:flex; gap:10px; justify-content:center; margin-top: 12px;
      flex-wrap: wrap;
    }
    .swatch{
      width: 44px; height: 44px; border-radius: 12px;
      border:1px solid var(--line);
      box-shadow: inset 0 0 0 2px rgba(255,255,255,0.08), 0 8px 18px rgba(0,0,0,.55);
    }

    /* VIDEO */
    .video-wrapper{
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      border-radius: 18px;
      border:1px solid var(--line);
      background:#000;
      box-shadow: 0 18px 40px rgba(0,0,0,.6);
    }
    .video-wrapper iframe{
      position:absolute; inset:0; width:100%; height:100%;
      border:0;
    }

    /* FOOTER + RSVP */
    footer{
      position:relative;
      padding: 90px 16px 50px;
      text-align:center;
      background: radial-gradient(800px 500px at 50% 0%, #0e1420, var(--bg));
      border-top: 1px solid var(--line);
      margin-top: 30px;
      scroll-margin-top: calc(var(--nav-h) + 20px);
    }
    .rsvp-card{
      width: min(640px, 92vw);
      margin: -140px auto 28px;
      padding: 26px 20px;
      border-radius: 22px;
      background: var(--glass-strong);
      border:1px solid var(--line);
      box-shadow: 0 25px 65px rgba(0,0,0,.7);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .rsvp-kicker{
      text-transform: uppercase;
      letter-spacing:.30em;
      font-size:.72rem;
      color: var(--ink-muted);
    }
    .rsvp-date{
      font-family: var(--serif);
      font-size: 1.5rem;
      color: var(--gold);
      letter-spacing:.12em;
      margin: 8px 0 6px;
      text-transform: uppercase;
    }
    .btn-rsvp{
      margin-top: 8px;
      background: linear-gradient(135deg, var(--gold), var(--gold-soft));
      color:#111827;
      border:none;
      padding: 12px 26px;
      border-radius: 999px;
      font-size: .86rem;
      font-weight: 800;
      letter-spacing:.2em;
      text-transform: uppercase;
      cursor:pointer;
      transition: transform .12s ease, filter .2s ease;
      box-shadow: 0 10px 30px rgba(214,179,108,.35);
    }
    .btn-rsvp:hover{ transform: translateY(-2px); filter: brightness(1.06); }

    .footer-msg{
      font-family: var(--script);
      font-size: clamp(1.8rem, 4.2vw, 2.6rem);
      color: var(--ink);
      opacity:.9;
      text-shadow: 0 0 18px rgba(122,169,255,.25);
    }
    .footer-small{
      font-size:.72rem; color: var(--ink-muted); opacity:.7; margin-top:10px;
      letter-spacing:.18em; text-transform: uppercase;
    }

    /* LIGHTBOX */
    .lightbox{
      display:none;
      position:fixed; inset:0; z-index:2000;
      background: rgba(3,5,9,0.95);
      justify-content:center; align-items:center; flex-direction:column;
    }
    .lightbox.active{ display:flex; }
    .lb-content{
      max-width: 92%; max-height: 82vh;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,0.2);
      box-shadow: 0 0 45px rgba(0,0,0,0.8);
      user-select:none; -webkit-user-drag:none;
    }
    .lb-close{
      position:absolute; top:16px; right:20px;
      color:#fff; font-size:2.8rem; cursor:pointer;
      background: transparent; border: none;
      text-shadow: 0 0 12px rgba(0,0,0,0.7);
    }
    .lb-nav{
      position:absolute; top:50%; transform:translateY(-50%);
      background: rgba(255,255,255,0.08);
      color:#fff;
      width:52px; height:52px; border-radius:999px;
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,0.25);
      cursor:pointer; font-size:2rem;
      transition: background .2s ease, transform .2s ease;
      z-index:2100;
    }
    .lb-nav:hover{ background: rgba(255,255,255,0.18); transform: translateY(-50%) scale(1.05); }
    .lb-prev{ left:16px; }
    .lb-next{ right:16px; }
    @media (max-width:600px){
      .lb-nav{ width:44px; height:44px; font-size:1.6rem; }
    }
    .lb-dots{
      position:absolute; bottom:20px; left:50%; transform:translateX(-50%);
      display:flex; gap:8px; padding:6px 10px;
      background: rgba(0,0,0,0.4);
      border-radius:999px; backdrop-filter: blur(6px);
      z-index:2100;
    }
    .lb-dot{
      width:9px; height:9px; border-radius:999px;
      background: rgba(255,255,255,0.45);
      cursor:pointer; transition: transform .2s ease, background .2s ease;
    }
    .lb-dot.active{ background:#fff; transform: scale(1.35); }

    /* ‚úÖ RSVP SWEETALERT (same function, new look) */
    .swal-bloom-popup{
      padding: 30px 30px 16px !important;
      max-width: 540px !important;
      border-radius: 18px !important;
      background: #0b1020 !important;
      border: 1px solid rgba(255,255,255,0.12) !important;
      color: var(--ink) !important;
      box-shadow: 0 25px 70px rgba(0,0,0,.7) !important;
      font-family: var(--sans) !important;
    }
    .swal-bloom-popup .swal2-title{
      font-family: var(--serif) !important;
      color: var(--gold-soft) !important;
      letter-spacing: .16em !important;
      text-transform: uppercase !important;
      font-size: 1.05rem !important;
    }
    .swal-bloom-btn{
      background: linear-gradient(135deg, var(--gold), var(--gold-soft)) !important;
      color:#0b1020 !important;
      border-radius: 999px !important;
      letter-spacing: .14em !important;
      text-transform: uppercase !important;
      font-weight: 800 !important;
      padding: .75rem 1.9rem !important;
    }
    .swal-bloom-cancel{
      background: transparent !important;
      color: var(--ink-muted) !important;
      border-radius: 999px !important;
      border: 1px solid rgba(255,255,255,0.12) !important;
      letter-spacing: .12em !important;
      text-transform: uppercase !important;
      padding: .7rem 1.6rem !important;
    }

    /* RSVP form inside swal */
    .swal-rsvp-wrap{
      display:grid; gap:14px; text-align:left; padding-top:4px;
    }
    .swal-field{ display:grid; gap:6px; }
    .swal-label{
      font-size:.75rem; text-transform:uppercase; letter-spacing:.18em;
      color: var(--ink-muted); font-weight:700;
    }
    .swal-input, .swal-textarea{
      width:100%;
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 12px;
      padding: 12px 14px;
      font-size: 1rem;
      font-family: var(--sans);
      outline:none;
      background: rgba(255,255,255,0.04);
      color: var(--ink);
      transition: border .2s ease, box-shadow .2s ease, background .2s ease;
    }
    .swal-input:focus, .swal-textarea:focus{
      border-color: rgba(214,179,108,0.7);
      box-shadow: 0 0 0 4px rgba(214,179,108,0.12);
      background: rgba(255,255,255,0.06);
    }
    .swal-textarea{ min-height: 90px; resize: vertical; }

    .swal-status-grid{
      display:grid; grid-template-columns: 1fr 1fr; gap:10px;
    }
    .swal-status{ position:relative; }
    .swal-status input{
      position:absolute; opacity:0; pointer-events:none;
    }
    .swal-status label{
      display:flex; align-items:center; justify-content:center; gap:8px;
      padding: 11px 10px;
      border-radius: 12px;
      border:1.5px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.04);
      font-weight:800; cursor:pointer;
      color: var(--ink);
      transition: all .2s ease;
    }
    .swal-status label .dot{
      width:9px; height:9px; border-radius:999px; background:#475569;
      transition: all .2s ease;
    }
    .swal-status input:checked + label{
      border-color: rgba(214,179,108,0.7);
      background: rgba(214,179,108,0.08);
      color: var(--gold-soft);
      box-shadow: inset 0 0 0 1px rgba(214,179,108,0.35);
    }
    .swal-status input:checked + label .dot{
      background: var(--gold);
      transform: scale(1.2);
    }
    .swal-persons-row{
      display:grid; grid-template-columns: 1fr auto auto; gap:8px; align-items:center;
    }
    .swal-stepper-btn{
      width:42px; height:42px; border-radius:10px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color: var(--ink);
      font-size:1.3rem; font-weight:900;
      cursor:pointer; transition: transform .12s ease, background .2s ease;
    }
    .swal-stepper-btn:hover{
      background: rgba(255,255,255,0.12);
      transform: translateY(-1px);
    }
    .swal-mini-note{
      font-size:.82rem; color: var(--ink-muted); text-align:center; margin-top:4px;
    }
  </style>
</head>
<body>

  <!-- Loading / Error -->
  <div id="loading" class="loading-overlay">
    <div class="loading-orb"></div>
    Loading Invitation
  </div>

  <div id="error" class="loading-overlay hidden" style="background:#02030a;">
    Invitation Not Found
  </div>

  <div id="invite-root" class="hidden">

    <!-- ‚úÖ TOPBAR -->
    <div class="topbar-bloom">
      <div class="topbar-brand">
        <div class="topbar-avatar" aria-hidden="true">
          <img id="topbar-hero-pic" alt="Couple photo" />
          <span id="topbar-initials">WG</span>
        </div>
        <div class="topbar-title" id="topbar-couple">Wedding Invitation</div>
      </div>

      <div class="topbar-links">
        <button class="topbar-link active" data-target="home-section">Home</button>
        <button class="topbar-link" data-target="story-section">Story</button>
        <button class="topbar-link" data-target="events-section">Events</button>
        <button class="topbar-link" data-target="gallery-section">Gallery</button>
        <button class="topbar-link" data-target="sponsors-section">Entourage</button>
        <button class="topbar-link" data-target="rsvp-section">RSVP</button>
      </div>

      <button class="topbar-ham" id="topbar-ham" aria-label="Open menu">
        <div><span></span><span></span><span></span></div>
      </button>
    </div>

    <!-- ‚úÖ TOPBAR MOBILE MENU -->
    <div class="topbar-mob" id="topbar-mob">
      <button class="topbar-link active" data-target="home-section">Home</button>
      <button class="topbar-link" data-target="story-section">Story</button>
      <button class="topbar-link" data-target="events-section">Events</button>
      <button class="topbar-link" data-target="gallery-section">Gallery</button>
      <button class="topbar-link" data-target="sponsors-section">Entourage</button>
      <button class="topbar-link" data-target="rsvp-section">RSVP</button>
    </div>

    <!-- HERO -->
    <header class="hero" id="home-section">
      <div id="hero-bg-1" class="hero-bg"></div>
      <div id="hero-bg-2" class="hero-bg"></div>
      <div class="hero-vignette"></div>

      <div class="hero-frame anim-up delay-100">
        <div class="hero-chip">
          <span class="dot"></span> We Invite You To Celebrate
        </div>

        <div class="hero-names">
          <span id="hero-bride">Bride</span>
          <div class="hero-amp">&</div>
          <span id="hero-groom">Groom</span>
        </div>

        <div class="hero-meta">
          <div class="hero-meta-pill">
            <span id="hero-date">Date</span>
          </div>
          <div class="hero-meta-pill">
            <span id="hero-time">Time</span>
          </div>
        </div>

        <div class="hero-venue" id="hero-venue">Location</div>
      </div>
    </header>

    <!-- COUNTDOWN -->
    <div id="countdown" class="countdown-container anim-up delay-200">
      <div id="countdown-label" class="countdown-title">Countdown to Forever</div>
      <div class="count-grid">
        <div class="count-item">
          <span id="cd-days" class="count-num">00</span>
          <span class="count-label">Days</span>
        </div>
        <div class="count-item">
          <span id="cd-hours" class="count-num">00</span>
          <span class="count-label">Hours</span>
        </div>
        <div class="count-item">
          <span id="cd-mins" class="count-num">00</span>
          <span class="count-label">Mins</span>
        </div>
        <div class="count-item">
          <span id="cd-secs" class="count-num">00</span>
          <span class="count-label">Secs</span>
        </div>
      </div>
    </div>

    <!-- STORY -->
    <section id="story-section">
      <div class="sec-head anim-up">
        <div class="sec-kicker">Our Journey</div>
        <h2 class="sec-title">How We Met</h2>
        <div class="sec-script">Two souls, one story</div>
        <div class="divider"></div>
      </div>

      <div class="panel anim-up delay-100">
        <p class="story-text anim-up delay-200" id="our-story"></p>
        <p class="story-text anim-up delay-300" id="proposal-story"></p>

        <div id="verse-block" class="verse-box anim-up delay-300 hidden">
          <div class="verse-text" id="verse-text"></div>
          <div class="verse-ref" id="verse-ref"></div>
        </div>
      </div>
    </section>

    <!-- EVENTS -->
    <section id="events-section">
      <div class="sec-head anim-up">
        <div class="sec-kicker">The Big Day</div>
        <h2 class="sec-title">Events</h2>
        <div class="sec-script">Be with us</div>
        <div class="divider"></div>
      </div>

      <div class="events-grid">

        <!-- Ceremony -->
        <div id="ceremony-card" class="event-card anim-up delay-200">
          <div class="event-badge">Ceremony</div>
          <div class="event-photo">
            <img id="ceremony-photo" alt="Ceremony venue photo">
            <div class="event-photo-placeholder" id="ceremony-photo-placeholder">No Image</div>
          </div>
          <div class="event-icon">üíç</div>
          <div class="event-name">Ceremony</div>
          <div class="event-detail" style="font-weight:700; color:var(--ink);" id="ceremony-name"></div>
          <div class="event-detail" id="ceremony-address"></div>
          <div class="event-detail" style="font-style:italic; margin-top:10px;" id="ceremony-notes"></div>
          <a id="ceremony-map" href="#" target="_blank" class="btn-outline hidden">View Map</a>
        </div>

        <!-- Reception -->
        <div id="reception-card" class="event-card anim-up delay-300">
          <div class="event-badge">Reception</div>
          <div class="event-photo">
            <img id="reception-photo" alt="Reception venue photo">
            <div class="event-photo-placeholder" id="reception-photo-placeholder">No Image</div>
          </div>
          <div class="event-icon">ü•Ç</div>
          <div class="event-name">Reception</div>
          <div class="event-detail" style="font-weight:700; color:var(--ink);" id="reception-name"></div>
          <div class="event-detail" id="reception-address"></div>
          <div class="event-detail" style="font-style:italic; margin-top:10px;" id="reception-notes"></div>
          <a id="reception-map" href="#" target="_blank" class="btn-outline hidden">View Map</a>
        </div>

      </div>
    </section>

    <!-- GALLERY -->
    <section id="gallery-section">
      <div class="sec-head anim-up">
        <div class="sec-kicker">Memories</div>
        <h2 class="sec-title">Gallery</h2>
        <div class="sec-script">A glimpse of us</div>
        <div class="divider"></div>
      </div>

      <div id="gallery-grid" class="gallery-grid anim-up delay-200"></div>
    </section>

    <!-- SPONSORS -->
    <section id="sponsors-section">
      <div class="sec-head anim-up">
        <div class="sec-kicker">Entourage</div>
        <h2 class="sec-title">With Gratitude</h2>
        <div class="sec-script">Our people</div>
        <div class="divider"></div>
      </div>

      <div id="sponsor-container" style="margin-top:18px;"></div>
    </section>

    <!-- DRESS + VIDEO -->
    <section id="details-section">
      <div id="dress-section" class="dress-code-box anim-up hidden">
        <div class="sec-kicker">Dress Code</div>
        <div id="dress-title" class="dress-title"></div>
        <p id="dress-desc" class="dress-desc"></p>
        <div class="palette" id="dress-colors"></div>
      </div>

      <div id="video-section" class="hidden anim-up" style="margin-top:50px;">
        <div class="sec-head">
          <div class="sec-kicker">Our Film</div>
          <h2 class="sec-title" style="font-size:1.8rem;">Our Video</h2>
          <div class="divider"></div>
        </div>
        <div class="video-wrapper" id="video-frame"></div>
      </div>
    </section>

    <!-- FOOTER + RSVP -->
    <footer id="rsvp-section">
      <div id="rsvp-container" class="rsvp-card anim-up hidden">
        <div class="rsvp-kicker">Kindly Respond By</div>
        <div id="rsvp-date" class="rsvp-date"></div>
        <p id="footer-note" style="color:var(--ink-muted); margin:0 0 16px;"></p>
        <button id="rsvp-button" class="btn-rsvp">RSVP Now</button>
      </div>

      <div class="footer-msg anim-up delay-200">Thank You</div>
      <div class="footer-small">&copy; 2025 Wedding Invitation</div>
    </footer>
  </div>

  <!-- LIGHTBOX -->
  <div id="lightbox" class="lightbox" aria-hidden="true">
    <button id="lb-close" class="lb-close" aria-label="Close">&times;</button>

    <button id="lb-prev" class="lb-nav lb-prev" aria-label="Previous photo">&#10094;</button>
    <img id="lb-img" class="lb-content" src="" alt="Gallery photo">
    <button id="lb-next" class="lb-nav lb-next" aria-label="Next photo">&#10095;</button>

    <div id="lb-dots" class="lb-dots" aria-label="Gallery navigation"></div>
  </div>

  <script>
    const SUPABASE_URL = "https://minftvflekxdoiubeujy.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pbmZ0dmZsZWt4ZG9pdWJldWp5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1MTc4NjgsImV4cCI6MjA2NjA5Mzg2OH0.Aj0-ts6WzffJRrXDkTMDKjQT4t6pW_-jSUft4md0KJM";

    const STATUS_PAIRS = [
      ["attending", "not_attending"],
      ["yes", "no"],
      ["confirmed", "declined"],
      ["going", "not_going"],
      ["accept", "regret"],
      ["accepted", "declined"],
    ];

    let galleryPhotos = [];
    let supabaseClient = null;
    let currentInviteId = null;
    let countdownInterval = null;
    let heroSlideIndex = 0;

    const hasText = (s) => s && s.trim().length > 0;

    const formatDate = (d) => {
      if (!d) return "";
      const dt = new Date(d + "T00:00:00");
      return isNaN(dt)
        ? d
        : dt.toLocaleDateString("en-US", { month: "long", day: "numeric", year: "numeric" });
    };

    const formatTime = (t) => {
      if (!t) return "";
      const parts = String(t).split(":");
      if (parts.length < 2) return t;
      const [h, m] = parts;
      const dt = new Date();
      dt.setHours(parseInt(h, 10), parseInt(m, 10), 0, 0);
      return dt.toLocaleTimeString("en-US", { hour: "numeric", minute: "2-digit" });
    };

    const getYoutubeSrc = (url) => {
      if (!hasText(url)) return null;
      let src = url.trim();
      try {
        if (src.includes("watch?v=")) {
          const u = new URL(src);
          const id = u.searchParams.get("v");
          if (id) src = "https://www.youtube.com/embed/" + id;
        } else if (src.includes("youtu.be/")) {
          const id = src.split("/").pop().split("?")[0];
          src = "https://www.youtube.com/embed/" + id;
        }
      } catch (e) {}
      return src;
    };

    /* ‚úÖ TOPBAR HELPERS */
    function scrollToBloom(id){
      const el = document.getElementById(id);
      if(!el) return;
      el.scrollIntoView({ behavior:"smooth", block:"start" });
      document.getElementById("topbar-mob")?.classList.remove("open");
    }

    function setupTopbar(){
      document.querySelectorAll(".topbar-link").forEach(btn=>{
        btn.addEventListener("click", ()=> scrollToBloom(btn.dataset.target));
      });
      const ham = document.getElementById("topbar-ham");
      const mob = document.getElementById("topbar-mob");
      ham?.addEventListener("click", ()=> mob.classList.toggle("open"));
    }

    function setupActiveTopbar(){
      const ids = ["home-section","story-section","events-section","gallery-section","sponsors-section","rsvp-section"];
      const sections = ids.map(id=>document.getElementById(id)).filter(Boolean);
      const navBtns = document.querySelectorAll(".topbar-link");

      const io = new IntersectionObserver((entries)=>{
        entries.forEach(entry=>{
          if(entry.isIntersecting){
            const id = entry.target.id;
            navBtns.forEach(b=>{
              b.classList.toggle("active", b.dataset.target === id);
            });
          }
        });
      }, { threshold:0.55 });

      sections.forEach(s=>io.observe(s));
    }

    function renderTopbarAvatar(photos, bride, groom){
      const pic = document.getElementById("topbar-hero-pic");
      const initialsEl = document.getElementById("topbar-initials");
      const initials = `${(bride||"B")[0]}${(groom||"G")[0]}`.toUpperCase();

      if(photos?.[0]){
        pic.src = photos[0];
        pic.style.display = "block";
        initialsEl.style.display = "none";
      }else{
        pic.style.display = "none";
        initialsEl.style.display = "inline";
        initialsEl.textContent = initials;
      }
    }

    function startAnimations() {
      const observer = new IntersectionObserver((entries, obs) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            obs.unobserve(entry.target);
          }
        });
      }, { threshold: 0.1 });

      document.querySelectorAll('.anim-up, .anim-fade').forEach(el => observer.observe(el));
    }

    function startHeroSlideshow() {
      if (galleryPhotos.length === 0) return;

      const bg1 = document.getElementById("hero-bg-1");
      const bg2 = document.getElementById("hero-bg-2");

      bg1.style.backgroundImage = `url('${galleryPhotos[0]}')`;
      bg1.classList.add("active");

      if (galleryPhotos.length < 2) return;

      let activeContainer = 1;

      setInterval(() => {
        heroSlideIndex = (heroSlideIndex + 1) % galleryPhotos.length;
        const nextImg = galleryPhotos[heroSlideIndex];

        const incoming = activeContainer === 1 ? bg2 : bg1;
        const outgoing = activeContainer === 1 ? bg1 : bg2;

        incoming.style.backgroundImage = `url('${nextImg}')`;
        incoming.classList.add("active");
        outgoing.classList.remove("active");

        activeContainer = activeContainer === 1 ? 2 : 1;
      }, 5200);
    }

    function setupCountdown(dateStr, timeStr) {
      const cdRoot = document.getElementById("countdown");
      if (!dateStr) { cdRoot.classList.add("hidden"); return; }

      const targetStr = timeStr ? `${dateStr}T${timeStr}` : `${dateStr}T00:00:00`;
      const target = new Date(targetStr);
      if (isNaN(target.getTime())) { cdRoot.classList.add("hidden"); return; }

      const els = {
        days: document.getElementById("cd-days"),
        hours: document.getElementById("cd-hours"),
        mins: document.getElementById("cd-mins"),
        secs: document.getElementById("cd-secs"),
        label: document.getElementById("countdown-label")
      };

      function tick() {
        const now = new Date();
        let diff = target.getTime() - now.getTime();

        if (diff <= 0) {
          clearInterval(countdownInterval);
          els.days.textContent = "0";
          els.hours.textContent = "0";
          els.mins.textContent = "0";
          els.secs.textContent = "0";
          els.label.textContent = "The Wedding Day is Here!";
          return;
        }

        const dayMs = 1000*60*60*24, hourMs = 1000*60*60, minMs = 1000*60;
        const d = Math.floor(diff / dayMs); diff -= d * dayMs;
        const h = Math.floor(diff / hourMs); diff -= h * hourMs;
        const m = Math.floor(diff / minMs); diff -= m * minMs;
        const s = Math.floor(diff / 1000);

        els.days.textContent = d;
        els.hours.textContent = h;
        els.mins.textContent = m;
        els.secs.textContent = s;
      }

      tick();
      countdownInterval = setInterval(tick, 1000);
    }

    function applyEventPhoto(imgId, placeholderId, url) {
      const img = document.getElementById(imgId);
      const ph = document.getElementById(placeholderId);
      if (!img || !ph) return;

      if (hasText(url)) {
        img.src = url;
        img.style.display = "block";
        ph.style.display = "none";
      } else {
        img.style.display = "none";
        ph.style.display = "block";
      }
    }

    /* ================================
       ‚úÖ RSVP LOGIC (same as yours)
       ================================ */
    async function tryInsertWithStatusPairs(payload, attendingBool) {
      for (let i = 0; i < STATUS_PAIRS.length; i++) {
        const [yesVal, noVal] = STATUS_PAIRS[i];
        const statusToSend = attendingBool ? yesVal : noVal;

        const { error } = await supabaseClient.from("rsvps").insert({
          ...payload,
          status: statusToSend
        });

        if (!error) return { ok: true, used: statusToSend };
        if (error.code !== "23514") return { ok: false, error };
      }
      return { ok: false, error: { message: "No status value matched your rsvps_status_check." } };
    }

    async function handleRSVP() {
      if (!supabaseClient || !currentInviteId) {
        Swal.fire("Error", "RSVP is not available right now.", "error");
        return;
      }

      const { value: formValues } = await Swal.fire({
        title: "RSVP",
        html: `
          <div class="swal-rsvp-wrap">

            <div class="swal-field">
              <div class="swal-label">Your Name</div>
              <input id="swal-name" class="swal-input" placeholder="e.g. Juan Dela Cruz">
            </div>

            <div class="swal-field">
              <div class="swal-label">Attendance</div>
              <div class="swal-status-grid">
                <div class="swal-status">
                  <input id="swal-attending" type="radio" name="status" value="attending" checked>
                  <label for="swal-attending"><span class="dot"></span> Attending</label>
                </div>
                <div class="swal-status">
                  <input id="swal-not-attending" type="radio" name="status" value="not_attending">
                  <label for="swal-not-attending"><span class="dot"></span> Not Attending</label>
                </div>
              </div>
            </div>

            <div class="swal-field">
              <div class="swal-label">Number of Guests</div>
              <div class="swal-persons-row">
                <input id="swal-persons" type="number" class="swal-input" value="1" min="1" />
                <button type="button" class="swal-stepper-btn" id="swal-minus">‚àí</button>
                <button type="button" class="swal-stepper-btn" id="swal-plus">+</button>
              </div>
              <div class="swal-mini-note">Including you</div>
            </div>

            <div class="swal-field">
              <div class="swal-label">Message (Optional)</div>
              <textarea id="swal-msg" class="swal-textarea" placeholder="Write a short message for the couple..."></textarea>
            </div>

          </div>
        `,
        showCancelButton: true,
        confirmButtonText: "Submit RSVP",
        cancelButtonText: "Cancel",
        customClass: {
          popup: "swal-bloom-popup",
          confirmButton: "swal-bloom-btn",
          cancelButton: "swal-bloom-cancel"
        },
        didOpen: () => {
          const minus = document.getElementById("swal-minus");
          const plus = document.getElementById("swal-plus");
          const inp = document.getElementById("swal-persons");

          minus.onclick = () => {
            let v = parseInt(inp.value || "1", 10);
            if (isNaN(v)) v = 1;
            v = Math.max(1, v - 1);
            inp.value = v;
          };
          plus.onclick = () => {
            let v = parseInt(inp.value || "1", 10);
            if (isNaN(v)) v = 1;
            inp.value = v + 1;
          };
        },
        preConfirm: () => {
          const name = document.getElementById("swal-name").value.trim();
          const status =
            document.querySelector("input[name='status']:checked")?.value || "attending";
          const personsRaw = document.getElementById("swal-persons").value;
          const msg = document.getElementById("swal-msg").value.trim();

          if (!name) {
            Swal.showValidationMessage("Please enter your name");
            return false;
          }

          let persons = parseInt(personsRaw, 10);
          if (isNaN(persons) || persons < 1) persons = 1;

          return { name, status, persons, msg };
        }
      });

      if (!formValues) return;

      const attendingBool = formValues.status === "attending";
      const payload = {
        invite_id: currentInviteId,
        name: formValues.name,
        message: formValues.msg,
        persons: formValues.persons
      };

      const result = await tryInsertWithStatusPairs(payload, attendingBool);

      if (!result.ok) {
        console.error("Error saving RSVP:", result.error);
        Swal.fire("Error", result.error.message || "Could not save RSVP.", "error");
        return;
      }

      Swal.fire({
        title: "Thank you!",
        text: "Your response has been recorded.",
        icon: "success",
        customClass: { popup: "swal-bloom-popup", confirmButton: "swal-bloom-btn" }
      });
    }
    /* ================================
       ‚úÖ END RSVP
       ================================ */

    /* ================================
       ‚úÖ LIGHTBOX SLIDER (same data)
       ================================ */
    let currentGalleryIndex = 0;
    let touchStartX = 0;

    function renderDots() {
      const dotsWrap = document.getElementById("lb-dots");
      if (!dotsWrap) return;
      dotsWrap.innerHTML = "";

      galleryPhotos.forEach((_, i) => {
        const dot = document.createElement("div");
        dot.className = "lb-dot" + (i === currentGalleryIndex ? " active" : "");
        dot.onclick = () => showGalleryIndex(i);
        dotsWrap.appendChild(dot);
      });
    }

    function showGalleryIndex(i) {
      if (!galleryPhotos.length) return;
      currentGalleryIndex = (i + galleryPhotos.length) % galleryPhotos.length;
      document.getElementById("lb-img").src = galleryPhotos[currentGalleryIndex];
      renderDots();
    }

    function openLightboxAt(i) {
      const lb = document.getElementById("lightbox");
      lb.classList.add("active");
      lb.setAttribute("aria-hidden", "false");
      showGalleryIndex(i);
    }

    function closeLightbox() {
      const lb = document.getElementById("lightbox");
      lb.classList.remove("active");
      lb.setAttribute("aria-hidden", "true");
    }

    function nextPhoto() { showGalleryIndex(currentGalleryIndex + 1); }
    function prevPhoto() { showGalleryIndex(currentGalleryIndex - 1); }

    function bindLightboxControls() {
      const lb = document.getElementById("lightbox");
      const closeBtn = document.getElementById("lb-close");
      const prevBtn = document.getElementById("lb-prev");
      const nextBtn = document.getElementById("lb-next");

      if (!lb) return;

      closeBtn.onclick = closeLightbox;
      prevBtn.onclick = prevPhoto;
      nextBtn.onclick = nextPhoto;

      lb.addEventListener("click", (e) => {
        if (e.target === lb) closeLightbox();
      });

      document.addEventListener("keydown", (e) => {
        if (!lb.classList.contains("active")) return;
        if (e.key === "ArrowRight") nextPhoto();
        if (e.key === "ArrowLeft") prevPhoto();
        if (e.key === "Escape") closeLightbox();
      });

      lb.addEventListener("touchstart", (e) => {
        touchStartX = e.changedTouches[0].screenX;
      }, { passive: true });

      lb.addEventListener("touchend", (e) => {
        const touchEndX = e.changedTouches[0].screenX;
        const diff = touchEndX - touchStartX;
        if (Math.abs(diff) > 40) diff < 0 ? nextPhoto() : prevPhoto();
      }, { passive: true });
    }
    /* ================================
       ‚úÖ END LIGHTBOX
       ================================ */

    async function init() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      currentInviteId = id;

      const loadingEl = document.getElementById("loading");
      const errorEl = document.getElementById("error");
      const rootEl = document.getElementById("invite-root");

      if (!window.supabase || !id) {
        loadingEl.classList.add("hidden");
        errorEl.classList.remove("hidden");
        return;
      }

      supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      const { data: row, error } = await supabaseClient
        .from("invites-new")
        .select("*")
        .eq("id", id)
        .maybeSingle();

      if (error || !row) {
        loadingEl.classList.add("hidden");
        errorEl.classList.remove("hidden");
        return;
      }

      document.getElementById("hero-bride").textContent = row.bride || "Bride";
      document.getElementById("hero-groom").textContent = row.groom || "Groom";
      document.getElementById("hero-date").textContent = formatDate(row.wedding_date);
      document.getElementById("hero-time").textContent = formatTime(row.wedding_time);
      document.getElementById("hero-venue").textContent =
        (row.main_venue_label || row.ceremony_name || "").toString().toUpperCase();

      setupCountdown(row.wedding_date, row.wedding_time);

      if (row.media_photos) {
        galleryPhotos = Array.isArray(row.media_photos)
          ? row.media_photos
          : row.media_photos.split(",").map(s => s.trim()).filter(Boolean);
      }
      if (galleryPhotos.length === 0 && row.ceremony_photo_url) {
        galleryPhotos.push(row.ceremony_photo_url);
      }

      startHeroSlideshow();

      if(row.our_story) document.getElementById("our-story").textContent = row.our_story;
      if(row.proposal_story) document.getElementById("proposal-story").textContent = row.proposal_story;

      if(row.verse_text) {
        document.getElementById("verse-block").classList.remove("hidden");
        document.getElementById("verse-text").textContent = `"${row.verse_text}"`;
        document.getElementById("verse-ref").textContent = row.verse_reference || "";
      }

      const ceremonyPhoto =
        row.ceremony_photo_url ||
        row.church_photo_url ||
        row.ceremony_photo ||
        row.church_photo ||
        "";

      const receptionPhoto =
        row.reception_photo_url ||
        row.venue_photo_url ||
        row.reception_photo ||
        row.venue_photo ||
        "";

      if (row.ceremony_name || row.ceremony_address || hasText(ceremonyPhoto)) {
        document.getElementById("ceremony-name").textContent = row.ceremony_name || "";
        document.getElementById("ceremony-address").textContent = row.ceremony_address || "";
        document.getElementById("ceremony-notes").textContent = row.ceremony_notes || "";
        applyEventPhoto("ceremony-photo", "ceremony-photo-placeholder", ceremonyPhoto);

        if(row.ceremony_map_url) {
          const btn = document.getElementById("ceremony-map");
          btn.href = row.ceremony_map_url;
          btn.classList.remove("hidden");
        }
      } else {
        document.getElementById("ceremony-card").classList.add("hidden");
      }

      if (row.reception_name || row.reception_address || hasText(receptionPhoto)) {
        document.getElementById("reception-name").textContent = row.reception_name || "";
        document.getElementById("reception-address").textContent = row.reception_address || "";
        document.getElementById("reception-notes").textContent = row.reception_notes || "";
        applyEventPhoto("reception-photo", "reception-photo-placeholder", receptionPhoto);

        if(row.reception_map_url) {
          const btn = document.getElementById("reception-map");
          btn.href = row.reception_map_url;
          btn.classList.remove("hidden");
        }
      } else {
        document.getElementById("reception-card").classList.add("hidden");
      }

      const galGrid = document.getElementById("gallery-grid");
      if (galleryPhotos.length > 0) {
        galleryPhotos.forEach((src, i) => {
          const img = document.createElement("img");
          img.src = src;
          img.className = "gallery-item anim-up";
          img.onclick = () => openLightboxAt(i);
          galGrid.appendChild(img);
        });
      } else {
        document.getElementById("gallery-section").classList.add("hidden");
      }

      bindLightboxControls();

      const spCon = document.getElementById("sponsor-container");
      const addSp = (title, txt) => {
        if (!hasText(txt)) return;
        const div = document.createElement("div");
        div.className = "sponsor-group anim-up";
        div.innerHTML = `<div class="sponsor-title">${title}</div><div class="sponsor-names">${txt}</div>`;
        spCon.appendChild(div);
      };

      addSp("Principal Sponsors", row.principal_sponsors);
      addSp("Parents of the Bride", row.parents_bride);
      addSp("Parents of the Groom", row.parents_groom);
      addSp("Maid of Honor", row.maid_of_honor_block);
      addSp("Best Man", row.best_man_block);
      addSp("Secondary Sponsors", row.secondary_sponsors);
      addSp("Flower Girls", row.flower_girls);
      addSp("Ring Bearer", row.ring_bearer);

      if(spCon.children.length === 0)
        document.getElementById("sponsors-section").classList.add("hidden");

      if(row.dress_title || row.dress_description) {
        document.getElementById("dress-section").classList.remove("hidden");
        document.getElementById("dress-title").textContent = row.dress_title || "Formal";
        document.getElementById("dress-desc").textContent = row.dress_description || "";
        const pal = document.getElementById("dress-colors");
        pal.innerHTML = "";
        [row.dress_color1, row.dress_color2, row.dress_color3]
          .filter(Boolean)
          .forEach(c => {
            const s = document.createElement("div");
            s.className = "swatch";
            s.style.background = c;
            pal.appendChild(s);
          });
      }

      if (row.media_video_url) {
        const src = getYoutubeSrc(row.media_video_url);
        if(src) {
          document.getElementById("video-section").classList.remove("hidden");
          document.getElementById("video-frame").innerHTML =
            `<iframe src="${src}" allowfullscreen></iframe>`;
        }
      }

      if(row.rsvp_deadline || row.rsvp_note) {
        document.getElementById("rsvp-container").classList.remove("hidden");
        document.getElementById("rsvp-date").textContent = formatDate(row.rsvp_deadline);
        document.getElementById("footer-note").textContent =
          row.rsvp_note || "Please confirm your attendance.";
        document.getElementById("rsvp-button").onclick = handleRSVP;
      }

      /* ‚úÖ TOPBAR SETUP + TITLE + AVATAR */
      setupTopbar();
      setupActiveTopbar();

      document.getElementById("topbar-couple").textContent =
        `${row.bride || "Bride"} & ${row.groom || "Groom"}`;
      renderTopbarAvatar(galleryPhotos, row.bride, row.groom);

      loadingEl.classList.add("hidden");
      rootEl.classList.remove("hidden");
      setTimeout(startAnimations, 100);
    }

    init();
  </script>
</body>
</html>
