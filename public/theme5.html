<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Blush Lace â€“ Cross-Fade Hero</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link
    href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=Montserrat:wght@300;400;500&family=Pinyon+Script&display=swap"
    rel="stylesheet"
  />

  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <!-- SweetAlert2 for RSVP popup -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root {
      /* PALETTE â€“ BLUSH + WHITE */
      --blush: #eabebb;
      --blush-deep: #d29a97;
      --blush-soft: #f7dedd;
      --blush-softer: #fdf3f2;

      --edge-line: #fdf5f3;
      --text-dark: #2d2222;
      --text-muted: #6f5b5b;

      --paper-bg-top: #fffdfc;
      --paper-bg-mid: #fff6f5;
      --paper-bg-bottom: #fbe9e7;

      --gold: #d3a867;
      --gold-soft: rgba(211, 168, 103, 0.45);

      --font-script: "Pinyon Script", cursive;
      --font-serif: "Cormorant Garamond", serif;
      --font-sans: "Montserrat", sans-serif;

      /* ANIMATION SETTINGS */
      --ease-elegant: cubic-bezier(0.25, 0.46, 0.45, 0.94);
      --duration: 1.4s;
       --topbar-height: 74px; /* adjust if needed */

    }



    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      background-color: var(--blush-softer);
      color: var(--text-dark);
      font-family: var(--font-serif);
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
    }

    /* UTILITIES */
    .hidden { display: none !important; }
    .text-center { text-align: center; }

    /* LOADING */
    .loading-overlay {
      position: fixed;
      inset: 0;
      z-index: 100;
      background: radial-gradient(circle at top, var(--blush) 0, #f3d1cf 40%, #f7e7e5 80%);
      display: flex;
      justify-content: center;
      align-items: center;
      color: #ffffff;
      font-family: var(--font-sans);
      letter-spacing: 0.2em;
      text-transform: uppercase;
      font-size: 0.8rem;
    }

    /* ANIMATIONS */
    .anim-up {
      opacity: 0;
      transform: translateY(40px);
      transition: opacity var(--duration) var(--ease-elegant),
                  transform var(--duration) var(--ease-elegant);
    }
    .anim-scale {
      opacity: 0;
      transform: scale(0.92);
      transition: opacity var(--duration) var(--ease-elegant),
                  transform var(--duration) var(--ease-elegant);
    }
    .visible {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    .delay-100 { transition-delay: 0.1s; }
    .delay-200 { transition-delay: 0.2s; }
    .delay-300 { transition-delay: 0.3s; }
    .delay-400 { transition-delay: 0.4s; }
    .delay-500 { transition-delay: 0.5s; }

    /* ===== HERO â€“ PROFESSIONAL / ELEGANT BANNER ===== */

    .hero-header {
      position: relative;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 44px 16px;
      overflow: hidden;
      padding-top: calc(30px + var(--topbar-height));
      /* more premium paper wash */
      background:
        radial-gradient(1100px 760px at 30% -10%, rgba(255,255,255,0.92), transparent 60%),
        radial-gradient(900px 620px at 110% 20%, rgba(255,244,244,0.95), transparent 55%),
        radial-gradient(760px 520px at 50% 120%, rgba(247, 215, 215, 0.85), transparent 60%),
        linear-gradient(180deg, #fff9f9 0%, #fdeeee 40%, #f7d7d7 100%);
    }

    /* subtle grain */
    .hero-header::before{
      content:"";
      position:absolute; inset:0;
      background-image:
        radial-gradient(circle at 10% 10%, rgba(255,255,255,0.55), transparent 35%),
        radial-gradient(circle at 90% 30%, rgba(255,255,255,0.35), transparent 40%),
        radial-gradient(circle at 35% 85%, rgba(255,255,255,0.35), transparent 45%);
      opacity: 0.55;
      pointer-events:none;
      mix-blend-mode: soft-light;
    }
    .hero-header::after{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(circle at 50% 20%, rgba(211,168,103,0.10), transparent 55%),
        linear-gradient(90deg, rgba(255,255,255,0.0), rgba(255,255,255,0.5), rgba(255,255,255,0.0));
      opacity: 0.35;
      pointer-events:none;
    }

    /* hide old dark image overlay for this theme */
    .hero-bg-layer,
    .hero-overlay-gradient {
      display: none;
    }

    /* WHITE CARD + REFINED FRAME */

    .hero-frame {
      position: relative;
      z-index: 2;
      max-width: 820px;
      width: 100%;
      text-align: center;

      background:
        radial-gradient(1200px 500px at 50% -10%, rgba(255,255,255,0.95), rgba(255,255,255,0.92)),
        #ffffff;
      border-radius: 34px;
      padding: 86px 56px 74px;

      box-shadow:
        0 34px 90px rgba(234, 190, 187, 0.55),
        0 0 0 1px rgba(255, 255, 255, 0.9);

      border: 1px solid rgba(234, 190, 187, 0.85);
      overflow: visible; /* allow florals to overflow the corners */
    }

    /* ornate gold line inside */
    .hero-frame::before{
      content:"";
      position:absolute;
      inset: 26px;
      border-radius: 30px;
      border: 1px solid rgba(211,168,103,0.55);
      pointer-events:none;
      opacity:0.9;
    }

    /* subtle corner accents */
    .hero-frame::after{
      content:"";
      position:absolute;
      inset: 44px;
      border-radius: 24px;
      border: 1px solid rgba(211,168,103,0.18);
      pointer-events:none;
      opacity:0.9;
    }

    /* FLORAL CORNERS â€“ RELATIVE TO CARD */
    .hero-floral {
      position: absolute;
      width: 260px;
      height: 260px;
      background-repeat: no-repeat;
      background-size: contain;
      background-position: center;
      pointer-events: none;
      z-index: 3;

      /* entrance animation */
      opacity: 0;
      transform: translateY(24px) scale(0.96);
      transition:
        opacity var(--duration) var(--ease-elegant),
        transform var(--duration) var(--ease-elegant);
      filter: saturate(1.02) contrast(1.02);
    }
    .hero-floral.visible {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    .hero-floral--tl {
      top: -44px;
      left: -44px;
      background-image: url("https://minftvflekxdoiubeujy.supabase.co/storage/v1/object/public/invite-photos/1a.png");
      transform-origin: top left;
    }
    .hero-floral--br {
      bottom: -44px;
      right: -44px;
      background-image: url("https://minftvflekxdoiubeujy.supabase.co/storage/v1/object/public/invite-photos/2.png");
      transform-origin: bottom right;
    }

    /* hide the circle photo (slideshow), kept for JS */
  /* Circle slideshow ABOVE names */
.hero-circle-wrap{
  display: grid;
  place-items: center;
  width: 190px;
  height: 190px;
  margin: 0 auto 22px;
  border-radius: 50%;
  position: relative;
  overflow: hidden;
  border: 3px solid rgba(234, 190, 187, 0.75);
  box-shadow: 0 18px 44px rgba(234, 190, 187, 0.55);
  background: rgba(234,190,187,0.10);
}

.hero-circle-img{
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  opacity: 0;
  transform: scale(1.02);
  transition: opacity 1.2s var(--ease-elegant), transform 1.2s var(--ease-elegant);
}

.hero-circle-img.active{
  opacity: 1;
  transform: scale(1);
}

@media (max-width: 640px){
  .hero-circle-wrap{ width: 160px; height: 160px; margin-bottom: 18px; }
}


    /* small premium monogram separator */
    .hero-monogram{
      display: inline-flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      margin: 10px 0 18px;
      font-family: var(--font-sans);
      font-size: 0.7rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: rgba(45,34,34,0.55);
    }
    .hero-monogram::before,
    .hero-monogram::after{
      content:"";
      width: 52px;
      height: 1px;
      background: linear-gradient(to right, transparent, rgba(211,168,103,0.85), transparent);
      opacity: 0.9;
    }

    /* TYPOGRAPHY */
    .invite-label {
      font-family: var(--font-sans);
      font-size: 0.72rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: rgba(45,34,34,0.55);
      margin-bottom: 18px;
    }

    .names-display {
      font-family: var(--font-script);
      font-size: 3.6rem;
      line-height: 1.14;
      color: #221a1a;
      margin: 6px 0 18px 0;
      text-rendering: geometricPrecision;
    }
    .names-display span { display: block; }

    .ampersand {
      font-size: 1.9rem;
      color: var(--gold);
      margin: 8px 0;
      font-family: var(--font-serif);
      letter-spacing: 0.06em;
      opacity: 0.95;
    }

    .date-display {
      font-family: var(--font-serif);
      font-size: 1.05rem;
      letter-spacing: 0.28em;
      text-transform: uppercase;
      color: rgba(45,34,34,0.80);
      padding: 12px 26px;
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      border-top: 1px solid rgba(211,168,103,0.75);
      border-bottom: 1px solid rgba(211,168,103,0.75);
      margin-top: 10px;
      background: rgba(255,255,255,0.55);
      border-radius: 999px;
    }
    .date-time {
      font-size: 0.9rem;
      letter-spacing: 0.18em;
      opacity: 0.9;
      margin-top: 4px;
    }

    /* countdown + venue */
    .countdown { margin-top: 22px; }
    .count-label {
      font-family: var(--font-sans);
      font-size: 0.65rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: rgba(45,34,34,0.45);
      margin-bottom: 10px;
    }
    .count-values {
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .count-box {
      min-width: 66px;
      padding: 8px 10px 9px;
      border-radius: 999px;
      border: 1px solid rgba(234, 190, 187, 0.55);
      background: rgba(255,255,255,0.72);
      box-shadow: 0 10px 24px rgba(234, 190, 187, 0.35);
      backdrop-filter: blur(10px);
    }
    .count-box span {
      display: block;
      font-family: var(--font-sans);
      font-size: 1.05rem;
      font-weight: 600;
      color: #2b2222;
    }
    .count-box small {
      display: block;
      font-family: var(--font-sans);
      font-size: 0.52rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: rgba(111, 91, 91, 0.78);
      margin-top: 3px;
    }

    /* top venue line */
    .hero-venue-line {
      margin-top: 24px;
      font-size: 0.9rem;
      letter-spacing: 0.10em;
      text-transform: uppercase;
      color: rgba(45,34,34,0.62);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    .reception-label {
      font-size: 0.72rem;
      letter-spacing: 0.20em;
      text-transform: uppercase;
      color: rgba(111, 91, 91, 0.75);
    }
    .reception-venue {
      font-size: 0.86rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: rgba(45,34,34,0.62);
    }

    /* mobile tweaks */
    @media (max-width: 640px) {
      .hero-frame {
        padding: 66px 22px 60px;
        border-radius: 24px;
      }
      .hero-frame::before{ inset: 18px; border-radius: 22px; }
      .hero-frame::after{ inset: 34px; border-radius: 18px; }

      .names-display { font-size: 2.8rem; }
      .hero-floral { width: 200px; height: 200px; }
      .hero-floral--tl { top: -64px; left: -64px; }
      .hero-floral--br { bottom: -64px; right: -64px; }
    }

    /* VENUE PHOTOS INSIDE INFO CARDS */
    .venue-photo-wrap {
      margin-top: 18px;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 12px 26px rgba(234, 190, 187, 0.35);
      background: #fff7f6;
      border: 1px solid rgba(234, 190, 187, 0.35);
    }
    .venue-photo-wrap img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      display: block;
    }

    /* PAPER SHEET */
    .paper-sheet {
      max-width: 980px;
      margin: -30px auto 40px;
      position: relative;
      z-index: 10;
      padding: 60px 36px 54px;
      background: radial-gradient(circle at top, var(--paper-bg-top) 0, var(--paper-bg-mid) 55%, var(--paper-bg-bottom) 100%);
      border-radius: 28px 28px 24px 24px;
      box-shadow:
        0 26px 70px rgba(234, 190, 187, 0.5),
        0 0 0 1px rgba(255, 255, 255, 0.9);
      border-top: 0px solid var(--blush);
    }
    .paper-sheet::before {
      content: "";
      position: absolute;
      inset: 16px 18px auto 18px;
      height: 1px;
      background: linear-gradient(
        to right,
        transparent,
        rgba(234, 190, 187, 0.8),
        transparent
      );
      opacity: 0.8;
    }

    @media (max-width: 600px) {
      .paper-sheet {
        margin: 0;
        border-radius: 0 0 22px 22px;
        padding: 42px 20px 40px;
      }
    }

    .divider {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 32px auto;
      width: 100%;
      max-width: 220px;
    }
    .divider::before,
    .divider::after {
      content: "";
      height: 1px;
      background: linear-gradient(
        to right,
        transparent,
        rgba(234, 190, 187, 0.8),
        transparent
      );
      flex: 1;
      transform: scaleX(0);
      transition: transform var(--duration) var(--ease-elegant);
      transform-origin: center;
    }
    .divider.visible::before,
    .divider.visible::after {
      transform: scaleX(1);
    }
    .divider-icon {
      width: 12px;
      height: 12px;
      background: radial-gradient(circle at 30% 20%, #fff8f7, var(--blush-deep));
      transform: rotate(45deg) scale(0);
      margin: 0 12px;
      border: 2px solid rgba(255, 255, 255, 0.9);
      box-shadow: 0 4px 10px rgba(234, 190, 187, 0.6);
      transition: transform var(--duration) var(--ease-elegant);
    }
    .divider.visible .divider-icon {
      transform: rotate(45deg) scale(1);
    }

    .section-title {
      font-family: var(--font-serif);
      font-size: 2.3rem;
      color: var(--text-dark);
      margin: 0 0 16px 0;
      font-weight: 400;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }
    .section-sub {
      font-family: var(--font-sans);
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.22em;
      color: var(--blush-deep);
      display: block;
      margin-bottom: 10px;
    }
    .story-text {
      font-size: 1.04rem;
      line-height: 1.9;
      color: var(--text-muted);
      max-width: 720px;
      margin: 0 auto;
    }
    .drop-cap::first-letter {
      color: var(--blush-deep);
      float: left;
      font-family: var(--font-script);
      font-size: 3.4rem;
      line-height: 0.8;
      padding-right: 10px;
      padding-top: 5px;
    }

    /* INFO CARDS */
    .cards-row {
      display: flex;
      flex-wrap: wrap;
      gap: 28px;
      justify-content: center;
      margin-top: 28px;
    }
    .info-card {
      flex: 1 1 300px;
      border-radius: 18px;
      border: 1px solid rgba(234, 190, 187, 0.55);
      padding: 36px 22px 32px;
      text-align: center;
      background:
        radial-gradient(circle at top, #fffafa 0, #fbe5e4 52%, #f4d4d3 100%);
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
      box-shadow: 0 12px 30px rgba(234, 190, 187, 0.35);
    }
    .info-card::before {
      content: "";
      position: absolute;
      inset: -20%;
      background:
        radial-gradient(circle at top, rgba(255, 255, 255, 0.7) 0, transparent 45%),
        radial-gradient(circle at bottom, rgba(234, 190, 187, 0.12) 0, transparent 50%);
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }
    .info-card:hover {
      transform: translateY(-6px);
      border-color: rgba(234, 190, 187, 0.9);
      box-shadow: 0 18px 40px rgba(234, 190, 187, 0.6);
    }
    .info-card:hover::before { opacity: 1; }

    .card-icon {
      font-size: 1.6rem;
      color: var(--blush-deep);
      margin-bottom: 18px;
      display: block;
    }
    .venue-name {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .card-heading-line {
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.23em;
      color: var(--text-muted);
      margin-bottom: 8px;
      font-family: var(--font-sans);
    }

    .btn-gold {
      display: inline-block;
      margin-top: 18px;
      padding: 10px 26px;
      background: var(--blush-deep);
      color: #ffffff;
      text-decoration: none;
      font-family: var(--font-sans);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.9);
      transition: background 0.3s, color 0.3s, transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
    }
    .btn-gold:hover {
      background: #ffffff;
      color: var(--text-dark);
      box-shadow: 0 12px 26px rgba(234, 190, 187, 0.55);
      transform: translateY(-1px);
    }

    /* GALLERY */
    .gallery-mosaic {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 26px;
    }
    @media (max-width: 640px) {
      .gallery-mosaic { grid-template-columns: repeat(2, 1fr); }
    }
    .gallery-mosaic img {
      width: 100%;
      aspect-ratio: 1/1;
      object-fit: cover;
      filter: saturate(1.05);
      transition: filter 0.3s, transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
      border-radius: 16px;
      box-shadow: 0 10px 24px rgba(234, 190, 187, 0.5);
    }
    .gallery-mosaic img:hover {
      filter: none;
      transform: translateY(-3px);
      box-shadow: 0 18px 40px rgba(234, 190, 187, 0.75);
      z-index: 2;
    }

    /* SPONSORS / ENTOURAGE */
    .sponsors-list {
      text-align: center;
      margin-top: 26px;
    }
    .sponsor-category { margin-bottom: 22px; }
    .sp-head {
      font-family: var(--font-sans);
      font-size: 1.1rem;
      font-weight: 700;
      text-transform: uppercase;
      color: var(--blush-deep);
      margin-bottom: 6px;
      letter-spacing: 0.18em;
    }
    .sp-names {
      font-size: 1.2rem;
      font-style: italic;
      color: var(--text-muted);
      white-space: pre-line;
    }

    /* DRESS CODE SECTION (after entourage) */
    #dress-section { margin-top: 54px; }
    .dress-title {
      font-size: 1.3rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--text-dark);
      margin: 10px 0 6px;
    }
    .dress-desc {
      font-size: 0.95rem;
      max-width: 700px;
      margin: 0 auto;
      color: var(--text-muted);
    }
    .palette-circles {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 14px;
    }
    .p-circle {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 1px solid rgba(0, 0, 0, 0.04);
      box-shadow: 0 8px 18px rgba(234, 190, 187, 0.55);
    }

    /* VIDEO */
    .video-box {
      margin-top: 40px;
      padding: 12px;
      border-radius: 18px;
      border: 1px solid rgba(234, 190, 187, 0.9);
      background: radial-gradient(circle at top, #fffdfc 0, #fbe5e4 55%, #f3d2d0 100%);
      box-shadow: 0 18px 38px rgba(234, 190, 187, 0.55);
    }
    .video-container {
      width: 100%;
      aspect-ratio: 16/9;
      background: #000;
      border-radius: 14px;
      overflow: hidden;
    }
    .video-container iframe {
      width: 100%;
      height: 100%;
      border: 0;
      display: block;
    }

    /* FOOTER & RSVP */
    .footer-section {
      background: radial-gradient(circle at top, #ffffff 0, #f5dcd9 35%, #eabebb 90%);
      color: var(--text-dark);
      text-align: center;
      padding: 60px 20px 50px;
      margin-top: 60px;
      position: relative;
    }
    .footer-section::before {
      content: "";
      position: absolute;
      top: 0;
      left: 50%;
      width: 120px;
      height: 4px;
      transform: translateX(-50%);
      background: linear-gradient(
        to right,
        transparent,
        rgba(255, 255, 255, 0.95),
        transparent
      );
    }

    .rsvp-display {
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.9);
      padding: 26px 22px 24px;
      max-width: 420px;
      margin: 0 auto 24px;
      background:
        radial-gradient(circle at top, rgba(255, 255, 255, 0.95), rgba(250, 228, 226, 0.96));
      box-shadow: 0 20px 50px rgba(234, 190, 187, 0.65);
    }
    .rsvp-date {
      font-size: 1.2rem;
      font-family: var(--font-serif);
      color: var(--text-dark);
      margin: 8px 0 14px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .footer-note-script {
      font-family: var(--font-script);
      font-size: 1.7rem;
      margin: 0;
      color: var(--text-dark);
      text-shadow: 0 2px 8px rgba(255, 255, 255, 0.9);
    }

    /* SWEETALERT2 â€“ RSVP THEME */
    .swal2-popup.rsvp-popup {
      background:
        radial-gradient(circle at top, #ffffff 0, #f8dedc 50%, #eabebb 100%);
      color: var(--text-dark);
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.9);
      box-shadow: 0 20px 50px rgba(234, 190, 187, 0.65);
      font-family: var(--font-sans);
      padding-bottom: 24px;
    }
    .swal2-title {
      font-family: var(--font-serif);
      letter-spacing: 0.16em;
      text-transform: uppercase;
      font-size: 1rem !important;
      color: var(--text-dark);
    }
    .swal2-html-container {
      margin: 0 0 8px;
      color: var(--text-muted);
      font-size: 0.82rem;
    }
    .swal2-input,
    .swal2-textarea {
      border-radius: 999px;
      border: 1px solid rgba(234, 190, 187, 0.9);
      background: rgba(255, 255, 255, 0.92);
      color: var(--text-dark);
      font-size: 0.8rem;
      padding-inline: 14px;
    }
    .swal2-textarea {
      border-radius: 12px;
      min-height: 70px;
      resize: vertical;
    }
    .swal2-input::placeholder,
    .swal2-textarea::placeholder {
      color: rgba(111, 91, 91, 0.5);
    }
    .swal2-label-inline {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
      margin-top: 6px;
      display: block;
    }
    .swal2-radio-row {
      display: flex;
      gap: 10px;
      font-size: 0.7rem;
      margin: 6px 0 8px;
      flex-wrap: wrap;
      color: var(--text-dark);
    }
    .swal2-radio-row label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.92);
      border: 1px solid rgba(234, 190, 187, 0.7);
      cursor: pointer;
    }
    .swal2-radio-row input {
      accent-color: var(--blush-deep);
      cursor: pointer;
    }
    .swal2-actions { margin-top: 10px !important; gap: 8px; }
    .swal2-confirm.rsvp-confirm {
      background: var(--blush-deep) !important;
      color: #ffffff !important;
      border-radius: 999px !important;
      font-size: 0.8rem !important;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      padding: 0.65rem 1.8rem !important;
      border: none !important;
    }
    .swal2-cancel.rsvp-cancel {
      background: transparent !important;
      color: var(--text-muted) !important;
      border-radius: 999px !important;
      font-size: 0.8rem !important;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      border: 1px solid rgba(234, 190, 187, 0.9) !important;
      padding: 0.6rem 1.6rem !important;
    }

    /* LIGHTBOX */
    .lightbox {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(26, 15, 15, 0.94);
      z-index: 200;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .lightbox.open { display: flex; }
    .lb-container {
      position: relative;
      max-width: 90%;
      max-height: 85vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .lb-img {
      max-width: 100%;
      max-height: 85vh;
      border: 2px solid #ffffff;
      box-shadow: 0 0 40px rgba(0, 0, 0, 0.8);
      transition: opacity 0.4s ease, transform 0.4s ease;
      cursor: grab;
      border-radius: 18px;
      background: #000;
    }
    .lb-img.fade-out {
      opacity: 0.5;
      transform: scale(0.98);
    }
    .lb-close {
      position: absolute;
      top: 20px;
      right: 20px;
      color: #ffffff;
      font-size: 2.5rem;
      cursor: pointer;
      z-index: 220;
      transition: color 0.3s;
      line-height: 1;
    }
    .lb-close:hover { color: var(--blush-soft); }
    .swipe-hint {
      position: absolute;
      bottom: 20px;
      color: #ffffff;
      font-size: 0.8rem;
      opacity: 0.7;
      letter-spacing: 1px;
      text-transform: uppercase;
      pointer-events: none;
    }

    /* ===== TOPBAR OVER HERO ===== */

    .hero-topbar {
      position: fixed;
      top: 18px;
      left: 50%;
      transform: translateX(-50%);
      width: min(100% - 32px, 980px);
      padding: 10px 16px;
      border-radius: 999px;
      background: rgba(255,255,255,0.82);
      border: 1px solid rgba(234, 190, 187, 0.55);
      box-shadow: 0 14px 30px rgba(174, 174, 174, 0.22);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      z-index: 999;
      backdrop-filter: blur(18px) saturate(1.2);
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }

    .topbar-avatar {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      overflow: hidden;
      border: 2px solid rgba(234, 190, 187, 0.75);
      box-shadow: 0 6px 14px rgba(234, 190, 187, 0.25);
      flex-shrink: 0;
      background: rgba(234,190,187,0.18);
    }

    .topbar-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      filter: saturate(0.98) contrast(0.98);
    }

    .topbar-names {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }

    .topbar-names-main {
      font-family: var(--font-script);
      font-size: 1.2rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: var(--text-dark);
      padding-right: 10px;
    }

    .topbar-names-sub {
      font-family: var(--font-sans);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: rgba(111, 91, 91, 0.72);
    }

    /* NAV LINKS (DESKTOP) */
    .topbar-nav {
      display: flex;
      align-items: center;
      gap: 16px;
      font-family: var(--font-sans);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .topbar-nav a {
      text-decoration: none;
      color: rgba(111, 91, 91, 0.78);
      padding-bottom: 2px;
      position: relative;
    }
    .topbar-nav a::after {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      bottom: -3px;
      height: 1px;
      background: linear-gradient(to right, transparent, rgba(211, 168, 103, 0.9), transparent);
      transform: scaleX(0);
      transform-origin: center;
      transition: transform 0.25s var(--ease-elegant);
    }
    .topbar-nav a:hover { color: var(--text-dark); }
    .topbar-nav a:hover::after { transform: scaleX(1); }

    .topbar-menu-btn {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      border: 1px solid rgba(234, 190, 187, 0.65);
      background: rgba(255, 255, 255, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 0;
      cursor: pointer;
    }
    .topbar-menu-btn span {
      display: block;
      width: 16px;
      height: 2px;
      border-radius: 999px;
      background: var(--text-dark);
      margin: 3px 0;
      transition: transform 0.2s ease, opacity 0.2s ease;
    }
    .topbar-menu-btn.open span:nth-child(1) { transform: translateY(8px) rotate(45deg); }
    .topbar-menu-btn.open span:nth-child(2) { opacity: 0; }
    .topbar-menu-btn.open span:nth-child(3) { transform: translateY(-8px) rotate(-45deg); }

    /* MOBILE DROPDOWN NAV */
    @media (max-width: 768px) {
      .topbar-nav {
        position: absolute;
        right: 16px;
        top: 100%;
        margin-top: 8px;
        background: rgba(255, 255, 255, 0.97);
        border-radius: 16px;
        padding: 10px 14px;
        box-shadow: 0 18px 40px rgba(234, 190, 187, 0.45);
        display: none;
        flex-direction: column;
        align-items: flex-start;
        z-index: 5;
      }
      .topbar-nav.open { display: flex; }
      .topbar-menu-btn { display: flex; }
    }
    @media (min-width: 769px) {
      .topbar-menu-btn { display: none; }
    }

    /* ===== HOTELS SECTION ===== */
#hotels-section { margin-top: 60px; }

.hotels-grid{
  display: grid;
  grid-template-columns: repeat(3, minmax(0,1fr));
  gap: 16px;
  margin-top: 26px;
}
@media (max-width: 980px){ .hotels-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
@media (max-width: 620px){ .hotels-grid{ grid-template-columns: 1fr; } }

.hotel-card{
  border-radius: 18px;
  border: 1px solid rgba(234, 190, 187, 0.55);
  background:
    radial-gradient(circle at top, #fffafa 0, #fbe5e4 52%, #f4d4d3 100%);
  box-shadow: 0 12px 30px rgba(234, 190, 187, 0.35);
  overflow: hidden;
  position: relative;
  transition: transform 0.28s ease, box-shadow 0.28s ease, border-color 0.28s ease;
}
.hotel-card:hover{
  transform: translateY(-6px);
  border-color: rgba(234, 190, 187, 0.9);
  box-shadow: 0 18px 40px rgba(234, 190, 187, 0.6);
}

.hotel-photo{
  width: 100%;
  height: 190px;
  object-fit: cover;
  display: block;
  background: #fff7f6;
}

.hotel-body{
  padding: 16px 16px 18px;
  text-align: center;
}

.hotel-name{
  font-family: var(--font-serif);
  font-size: 1.05rem;
  letter-spacing: 0.10em;
  text-transform: uppercase;
  color: var(--text-dark);
  font-weight: 700;
  margin: 6px 0 10px;
}

.hotel-actions{
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 12px;
}

.hotel-qr-wrap{
  margin-top: 12px;
  display: grid;
  place-items: center;
  gap: 8px;
}
.hotel-qr{
  width: 120px;
  height: 120px;
  border-radius: 14px;
  background: rgba(255,255,255,0.85);
  border: 1px solid rgba(234,190,187,0.65);
  box-shadow: 0 12px 26px rgba(234,190,187,0.35);
  padding: 10px;
}
.hotel-qr-note{
  font-family: var(--font-sans);
  font-size: 0.62rem;
  letter-spacing: 0.16em;
  text-transform: uppercase;
  color: rgba(111, 91, 91, 0.78);
}

.hotel-link{
  display: inline-block;
  margin-top: 10px;
  font-family: var(--font-sans);
  font-size: 0.7rem;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: rgba(111, 91, 91, 0.85);
  text-decoration: none;
}
.hotel-link:hover{ color: var(--text-dark); text-decoration: underline; }


/* ===== VENUE PHOTO QR OVERLAY ===== */
.venue-photo-wrap{
  position: relative; /* required for overlay */
}

.venue-qr{
  position: absolute;
  bottom: 10px;
  right: 10px;
  width: 100px;
  height: 100px;
  padding: 6px;
  border-radius: 14px;
  background: rgba(255,255,255,0.92);
  border: 1px solid rgba(234,190,187,0.7);
  box-shadow: 0 10px 22px rgba(234,190,187,0.45);
  display: grid;
  place-items: center;
}

.venue-qr img{
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.venue-qr-label{
  position: absolute;
  bottom: 86px;
  right: 10px;
  font-family: var(--font-sans);
  font-size: 0.55rem;
  letter-spacing: 0.16em;
  text-transform: uppercase;
  color: rgba(255,255,255,0.95);
  background: rgba(0,0,0,0.45);
  padding: 4px 8px;
  border-radius: 999px;
  backdrop-filter: blur(6px);
}

/* mobile tweak */
@media (max-width: 480px){
  .venue-qr{ width: 82px; height: 82px; }
  .venue-qr-label{ font-size: 0.5rem; }
}

.date-row{
  display: flex;
  justify-content: center;
  margin-top: 8px;
}

  </style>
</head>
<body>

  <div id="loading" class="loading-overlay">
    Loading Invitation...
  </div>
  <div id="error" class="loading-overlay hidden" style="background:#333;">
    Invitation Not Found
  </div>

  <div id="invite-root" class="hidden">

    <header class="hero-header" id="top-header">
      <!-- optional BG layer, kept so JS doesn't break -->
      <div class="hero-bg-layer" id="hero-bg"></div>
      <div class="hero-overlay-gradient"></div>

      <!-- ðŸŒ¸ TOPBAR -->
      <div class="hero-topbar anim-up delay-100">
        <div class="topbar-left">
          <div class="topbar-avatar">
            <img id="topbar-avatar" src="" alt="Couple photo" />
          </div>
          <div class="topbar-names">
            <div class="topbar-names-main" id="topbar-names-main">Bride & Groom</div>
    
          </div>
        </div>

        <button class="topbar-menu-btn" id="topbar-menu-btn" aria-label="Menu">
          <span></span><span></span><span></span>
        </button>

        <nav class="topbar-nav" id="topbar-nav">
          <a href="#top-header" data-nav="top-header">Invitation</a>
          <a href="#story-section" data-nav="story-section">Story</a>
          <a href="#weddingday-section" data-nav="weddingday-section">Details</a>
          <a href="#gallery-section" data-nav="gallery-section">Gallery</a>
          <a href="#sponsors-section" data-nav="sponsors-section">Entourage</a>
          <a href="#dress-section" data-nav="dress-section">Dress Code</a>
          <a href="#video-section" data-nav="video-section">Video</a>
          <a href="#hotels-section" data-nav="hotels-section"> Nearby Hotels</a>

          <a href="#rsvp-container" data-nav="rsvp-container">RSVP</a>
        </nav>
      </div>

      <div class="hero-frame anim-up delay-100">
        <!-- FLORAL CORNERS -->
        <div class="hero-floral hero-floral--tl"></div>
        <div class="hero-floral hero-floral--br"></div>

        <!-- kept but hidden in CSS -->
        <div class="hero-circle-wrap anim-scale delay-200">
          <img id="slide-1" class="hero-circle-img active" src="" alt="Slide 1" />
          <img id="slide-2" class="hero-circle-img" src="" alt="Slide 2" />
        </div>

        <div class="invite-label anim-up delay-300">
          The honor of your presence is requested at the wedding of
        </div>

        <div class="names-display anim-up delay-400">
          <span id="hero-bride">Bride Name</span>
          <span class="ampersand">&</span>
          <span id="hero-groom">Groom Name</span>
        </div>

        <div class="hero-monogram anim-up delay-400">Save the Date</div>

<div class="date-row anim-up delay-500">
  <div class="date-display">
    <span id="hero-date">June 20, 2026</span>
    <span id="hero-time" class="date-time">2:00 PM</span>
  </div>
</div>


        <!-- COUNTDOWN -->
        <div id="countdown" class="countdown anim-up delay-500">
          <div id="countdown-label" class="count-label">Countdown to our wedding</div>
          <div class="count-values">
            <div class="count-box"><span id="cd-days">00</span><small>Days</small></div>
            <div class="count-box"><span id="cd-hours">00</span><small>Hours</small></div>
            <div class="count-box"><span id="cd-mins">00</span><small>Minutes</small></div>
            <div class="count-box"><span id="cd-secs">00</span><small>Seconds</small></div>
          </div>
        </div>

        <div class="hero-venue-line anim-up delay-500">
          <span id="hero-venue">Orion United Methodist Church Â· Orion, Bataan</span>

          <span id="hero-reception-label" class="reception-label hidden">Reception follows at</span>
          <span id="hero-reception-venue" class="reception-venue hidden">The Royal Garden Â· Balanga, Bataan</span>
        </div>
      </div>
    </header>

    <div class="paper-sheet anim-up delay-300">
      <!-- STORY -->
      <section id="story-section" class="text-center">
       
       

        <p class="story-text drop-cap anim-up delay-300" id="our-story"></p>
        <p class="story-text anim-up delay-400" id="proposal-story" style="margin-top:20px;"></p>

        <div
          id="verse-block"
          class="hidden anim-up delay-500"
          style="margin-top:30px; padding:20px 18px; background:var(--blush-soft); border-radius:16px; display:inline-block; border:1px solid rgba(234,190,187,0.9);"
        >
          <p
            style="font-family:var(--font-script); font-size:1.5rem; color:var(--text-dark); margin:0 0 6px;"
            id="verse-text"
          ></p>
          <small
            class="text-center"
            style="display:block; margin-top:4px; text-transform:uppercase; letter-spacing:0.14em; font-size:0.65rem; color:var(--text-muted);"
            id="verse-ref"
          ></small>
        </div>
      </section>

      <div class="divider anim-scale" data-divider="after-story">
        <div class="divider-icon"></div>
      </div>

      <!-- ITINERARY / CEREMONY & RECEPTION -->
      <section id="weddingday-section">
        <div class="text-center">
          <span class="section-sub anim-up">Itinerary</span>
          <h2 class="section-title anim-up delay-100">The Wedding Day</h2>
        </div>

        <div class="cards-row">
          <div class="info-card anim-up delay-200" id="ceremony-card">
            <span class="card-icon anim-scale delay-300">&#10084;</span>
            <div class="card-heading-line">Ceremony</div>
            <div class="venue-name" id="ceremony-name">Venue Name</div>
            <p style="margin:10px 0; font-size:0.9rem;" id="ceremony-address"></p>
            <p style="font-style:italic; font-size:0.85rem; color:var(--text-muted);" id="ceremony-notes"></p>

            <div class="venue-photo-wrap" id="ceremony-photo-wrap" style="display:none;">
  <img id="ceremony-photo" src="" alt="Ceremony venue photo" />

  <!-- QR overlay -->
  <div class="venue-qr hidden" id="ceremony-qr">
    <img id="ceremony-qr-img" src="" alt="Ceremony map QR" />
  </div>
  <div class="" id="ceremony-qr-label">

  </div>
</div>


            <a id="ceremony-map" href="#" target="_blank" class="btn-gold hidden">Directions</a>
          </div>

          <div class="info-card anim-up delay-300" id="reception-card">
            <span class="card-icon anim-scale delay-400">&#127864;</span>
            <div class="card-heading-line">Reception</div>
            <div class="venue-name" id="reception-name">Venue Name</div>
            <p style="margin:10px 0; font-size:0.9rem;" id="reception-address"></p>
            <p style="font-style:italic; font-size:0.85rem; color:var(--text-muted);" id="reception-notes"></p>

<div class="venue-photo-wrap" id="reception-photo-wrap" style="display:none;">
  <img id="reception-photo" src="" alt="Reception venue photo" />

  <!-- QR overlay -->
  <div class="venue-qr hidden" id="reception-qr">
    <img id="reception-qr-img" src="" alt="Reception map QR" />
  </div>
  <div class="" id="reception-qr-label">

  </div>
</div>


            <a id="reception-map" href="#" target="_blank" class="btn-gold hidden">Directions</a>
          </div>
        </div>
      </section>

      <div class="divider anim-scale" data-divider="after-weddingday">
        <div class="divider-icon"></div>
      </div>

      <!-- GALLERY -->
      <section id="gallery-section" class="text-center">
        <span class="section-sub anim-up">Memories</span>
        <h2 class="section-title anim-up delay-100">Gallery</h2>
        <div class="gallery-mosaic anim-up delay-200" id="gallery-grid"></div>
      </section>

      <!-- ENTOURAGE -->
      <section id="sponsors-section" style="margin-top:60px;">
        <div class="text-center">
          <span class="section-sub anim-up">Entourage</span>
          <h2 class="section-title anim-up delay-100">With Gratitude</h2>
        </div>
        <div class="sponsors-list" id="sponsor-container"></div>
      </section>

      <!-- DRESS CODE (AFTER ENTOURAGE) -->
      <section id="dress-section" class="text-center hidden" style="margin-top:54px;">
        <span class="section-sub anim-up">Dress Code</span>
        <h2 class="section-title anim-up delay-100">Attire</h2>
        <p class="story-text dress-desc anim-up delay-200" id="dress-desc" style="font-size:0.95rem;"></p>
        <h3 class="dress-title anim-up delay-200" id="dress-title">Formal</h3>
        <div class="palette-circles anim-up delay-300" id="dress-colors"></div>
      </section>

      <!-- VIDEO -->
      <section id="video-section" class="hidden anim-up" style="margin-top:54px;">
        <div class="text-center">
          <span class="section-sub">Film</span>
          <h2 class="section-title" style="font-size:1.7rem;">Our Story in Motion</h2>
        </div>
        <div class="video-box anim-scale delay-200">
          <div class="video-container" id="video-frame"></div>
        </div>
      </section>
          <!-- HOTELS -->
<section id="hotels-section" class="text-center hidden">
  <span class="section-sub anim-up">Stay</span>
  <h2 class="section-title anim-up delay-100">Nearby Hotels</h2>
  <div class="divider anim-scale delay-200" data-divider="after-hotels">
    <div class="divider-icon"></div>
  </div>

  <div class="hotels-grid" id="hotels-grid"></div>
</section>


    </div>


    <!-- FOOTER & RSVP -->
    <footer class="footer-section">
      <div id="rsvp-container" class="anim-up">
        <div class="rsvp-display">
          <div class="invite-label" style="margin-bottom:4px;">Kindly Respond By</div>
          <div class="rsvp-date" id="rsvp-date">â€”</div>
          <button id="rsvp-button" class="btn-gold" style="background:var(--blush-deep); color:#fff; margin-top:6px;">
            RSVP Now
          </button>
        </div>
      </div>
      <p class="footer-note-script anim-up delay-200" id="footer-note">
        Thank you for celebrating with us.
      </p>
    </footer>
  </div>

  <!-- LIGHTBOX -->
  <div class="lightbox" id="lightbox">
    <span class="lb-close" id="lb-close">&times;</span>
    <div class="lb-container">
      <img class="lb-img" id="lb-img" src="" alt="Gallery Image" />
    </div>
    <div class="swipe-hint">Swipe or use Arrow Keys</div>
  </div>

  <script>
    /* --- CONFIG --- */
    const SUPABASE_URL = "https://minftvflekxdoiubeujy.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pbmZ0dmZsZWt4ZG9pdWJldWp5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1MTc4NjgsImV4cCI6MjA2NjA5Mzg2OH0.Aj0-ts6WzffJRrXDkTMDKjQT4t6pW_-jSUft4md0KJM";

    const INVITES_TABLE = "invites-new";
    const RSVPS_TABLE = "rsvps";

    // âœ… RSVP robustness (same idea as your working page)
    const STATUS_PAIRS = [
      ["attending", "not_attending"],
      ["yes", "no"],
      ["confirmed", "declined"],
      ["going", "not_going"],
      ["accept", "regret"],
      ["accepted", "declined"],
    ];
    const RSVP_INVITE_COLS = ["invite_id", "host_id", "invite_code", "inviteid", "invite"]; // try these in insert

    let galleryPhotos = [];
    let currentPhotoIndex = 0;
    let heroSlideIndex = 0;
    let activeSlideElement = 1;
    let supabaseClient = null;
    let currentInviteId = null;
    let countdownInterval = null;

    /* --- UTILS --- */
    const hasText = (s) => s && String(s).trim().length > 0;

    // Simple QR via public endpoint (no extra library needed)
const qrUrl = (text, size=220) =>
  "https://api.qrserver.com/v1/create-qr-code/?size=" + size + "x" + size + "&data=" + encodeURIComponent(text);


    const formatDate = (d) => {
      if (!d) return "";
      const dt = new Date(String(d).includes("T") ? d : d + "T00:00:00");
      return isNaN(dt)
        ? String(d)
        : dt.toLocaleDateString("en-US", { month: "long", day: "numeric", year: "numeric" });
    };

    const formatTime = (t) => {
      if (!t) return "";
      const parts = String(t).split(":");
      if (parts.length < 2) return String(t);
      const [h, m] = parts;
      const dt = new Date();
      dt.setHours(h, m, 0, 0);
      return dt.toLocaleTimeString("en-US", { hour: "numeric", minute: "2-digit" });
    };

    const getYoutubeSrc = (url) => {
      if (!hasText(url)) return null;
      let src = String(url).trim();
      try {
        if (src.includes("watch?v=")) {
          const u = new URL(src);
          const id = u.searchParams.get("v");
          if (id) src = "https://www.youtube.com/embed/" + id;
        } else if (src.includes("youtu.be/")) {
          const id = src.split("/").pop().split("?")[0];
          src = "https://www.youtube.com/embed/" + id;
        }
      } catch (e) {}
      return src;
    };

    function setDividerVisible(visible) {
      document.querySelectorAll('[data-divider]').forEach(d => {
        d.classList.toggle("hidden", !visible);
      });
    }

    function toggleNavFor(sectionId, show) {
      document.querySelectorAll(`[data-nav="${sectionId}"]`).forEach(a => {
        a.classList.toggle("hidden", !show);
      });
    }

function startAnimations() {
  const targets = document.querySelectorAll(".anim-up, .anim-scale, .divider, .hero-floral");

  // âœ… Fallback for older / buggy mobile browsers
  if (!("IntersectionObserver" in window)) {
    targets.forEach(el => el.classList.add("visible"));
    return;
  }

  const observer = new IntersectionObserver(
    (entries, obs) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("visible");
          obs.unobserve(entry.target);
        }
      });
    },
    {
      threshold: 0.12,
      rootMargin: "0px 0px -10% 0px" // âœ… helps mobile trigger earlier
    }
  );

  targets.forEach((el) => observer.observe(el));

  // âœ… Extra safety: if user scrolls and something still didn't trigger, force show after a short delay
  setTimeout(() => {
    targets.forEach(el => el.classList.add("visible"));
  }, 2500);
}


    /* --- CROSS-FADE SLIDESHOW (kept) --- */
    function startHeroSlideshow() {
      if (galleryPhotos.length < 2) return;

      setInterval(() => {
        const nextIndex = (heroSlideIndex + 1) % galleryPhotos.length;
        const nextElementId = activeSlideElement === 1 ? "slide-2" : "slide-1";
        const currentElementId = activeSlideElement === 1 ? "slide-1" : "slide-2";

        const nextEl = document.getElementById(nextElementId);
        const currentEl = document.getElementById(currentElementId);

        nextEl.src = galleryPhotos[nextIndex];
        nextEl.classList.add("active");
        currentEl.classList.remove("active");

        heroSlideIndex = nextIndex;
        activeSlideElement = activeSlideElement === 1 ? 2 : 1;
      }, 3000);
    }

    /* --- COUNTDOWN --- */
function setupCountdown(dateStr, timeStr) {
  const cdRoot = document.getElementById("countdown");
  if (!cdRoot || !dateStr) {
    if (cdRoot) cdRoot.classList.add("hidden");
    return;
  }

  let targetStr = String(dateStr);
  if (timeStr) targetStr += "T" + String(timeStr);
  else targetStr += "T00:00:00";

  const target = new Date(targetStr);
  if (isNaN(target.getTime())) {
    cdRoot.classList.add("hidden");
    return;
  }

  const daysEl = document.getElementById("cd-days");
  const hoursEl = document.getElementById("cd-hours");
  const minsEl = document.getElementById("cd-mins");
  const secsEl = document.getElementById("cd-secs");
  const labelEl = document.getElementById("countdown-label");

  // Make it â€œtogetherâ€ in one line by changing label text + keeping boxes
  // (If you want literally ONE single text string, see the optional step below.)
  function tick() {
    const now = new Date();
    let diffMs = now.getTime() - target.getTime(); // ðŸ‘ˆ count UP after wedding

    const isAfter = diffMs >= 0;

    // If wedding is still in the future, show negative as countdown
    // (If you want ALWAYS count-up only, just remove the else block.)
    if (!isAfter) diffMs = target.getTime() - now.getTime();

    const dayMs = 1000 * 60 * 60 * 24;
    const hourMs = 1000 * 60 * 60;
    const minMs = 1000 * 60;

    const days = Math.floor(diffMs / dayMs);
    diffMs -= days * dayMs;
    const hours = Math.floor(diffMs / hourMs);
    diffMs -= hours * hourMs;
    const mins = Math.floor(diffMs / minMs);
    diffMs -= mins * minMs;
    const secs = Math.floor(diffMs / 1000);

    daysEl.textContent = String(days).padStart(2, "0");
    hoursEl.textContent = String(hours).padStart(2, "0");
    minsEl.textContent = String(mins).padStart(2, "0");
    secsEl.textContent = String(secs).padStart(2, "0");

    if (labelEl) {
      labelEl.textContent = isAfter
        ? "Married for (and counting)"
        : "Countdown to our wedding";
    }
  }

  tick();
  clearInterval(countdownInterval);
  countdownInterval = setInterval(tick, 1000);
}


    /* --- RSVP ROBUST INSERT (theme5 now like your working page) --- */

    async function tryInsertRSVPWithStatusPairs(basePayload, attendingBool) {
      for (let i = 0; i < STATUS_PAIRS.length; i++) {
        const [yesVal, noVal] = STATUS_PAIRS[i];
        const statusToSend = attendingBool ? yesVal : noVal;

        const { error } = await supabaseClient
          .from(RSVPS_TABLE)
          .insert({ ...basePayload, status: statusToSend });

        if (!error) return { ok: true, used: statusToSend };

        // if check-constraint on status, keep trying
        // Postgres check constraint usually returns 23514
        if (error.code !== "23514") return { ok: false, error };
      }
      return { ok: false, error: { message: "No status matched your RSVP status constraint." } };
    }

    async function insertRSVP(payloadCore, attendingBool) {
      // Try multiple invite column names to match your DB schema.
      let lastErr = null;

      for (const inviteCol of RSVP_INVITE_COLS) {
        const payload = { ...payloadCore };
        // remove any invite cols first then set one
        RSVP_INVITE_COLS.forEach((c) => delete payload[c]);
        payload[inviteCol] = currentInviteId;

        const res = await tryInsertRSVPWithStatusPairs(payload, attendingBool);

        if (res.ok) return res;

        lastErr = res.error;

        // If column doesn't exist, Postgres often returns 42703 (undefined column)
        // If it's not that, or not status constraint, don't loop forever; still try next invite col anyway.
      }

      return { ok: false, error: lastErr || { message: "RSVP insert failed." } };
    }

    async function handleRSVP() {
      if (!supabaseClient || !currentInviteId) {
        Swal.fire("Error", "RSVP is not available at this moment.", "error");
        return;
      }

      const { value: formValues } = await Swal.fire({
        title: "RSVP",
        html: `
          <div style="text-align:left;">
            <span class="swal2-label-inline">Name</span>
            <input id="swal-name" class="swal2-input" placeholder="Your full name" />

            <span class="swal2-label-inline">Status</span>
            <div class="swal2-radio-row">
              <label><input type="radio" name="swal-status" value="attending" checked /> Attending</label>
              <label><input type="radio" name="swal-status" value="not_attending" /> Not Attending</label>
            </div>

            <span class="swal2-label-inline">Number of Guests (including you)</span>
            <input id="swal-persons" type="number" min="1" class="swal2-input" value="1" />

            <span class="swal2-label-inline">Message (optional)</span>
            <textarea id="swal-message" class="swal2-textarea" placeholder="Any notes for the couple?"></textarea>
          </div>
        `,
        focusConfirm: false,
        showCancelButton: true,
        confirmButtonText: "Submit RSVP",
        cancelButtonText: "Cancel",
        customClass: {
          popup: "rsvp-popup",
          confirmButton: "rsvp-confirm",
          cancelButton: "rsvp-cancel",
        },
        preConfirm: () => {
          const name = document.getElementById("swal-name").value.trim();
          const personsRaw = document.getElementById("swal-persons").value;
          const message = document.getElementById("swal-message").value.trim();
          const statusInput = document.querySelector("input[name='swal-status']:checked");
          const status = statusInput ? statusInput.value : "attending";

          if (!name) {
            Swal.showValidationMessage("Please enter your name.");
            return false;
          }

          let persons = parseInt(personsRaw, 10);
          if (isNaN(persons) || persons < 1) persons = 1;

          return { name, persons, message, status };
        },
      });

      if (!formValues) return;

      try {
        const attendingBool = formValues.status === "attending";

        // Core payload (invite col will be injected by insertRSVP)
        const payloadCore = {
          name: formValues.name,
          persons: formValues.persons,
          message: formValues.message,
        };

        const result = await insertRSVP(payloadCore, attendingBool);

        if (!result.ok) {
          console.error("RSVP insert error:", result.error);
          Swal.fire("Oops", result.error?.message || "We couldnâ€™t save your RSVP. Please try again later.", "error");
          return;
        }

        Swal.fire({
          title: "Thank you!",
          text: "Your RSVP has been recorded.",
          icon: "success",
          confirmButtonText: "Close",
          customClass: {
            popup: "rsvp-popup",
            confirmButton: "rsvp-confirm",
          },
        });
      } catch (err) {
        console.error("Unexpected RSVP error:", err);
        Swal.fire("Error", "Something went wrong. Please try again.", "error");
      }
    }

    /* --- RENDER --- */
    async function init() {
      const loading = document.getElementById("loading");
      const errorEl = document.getElementById("error");
      const root = document.getElementById("invite-root");

      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      currentInviteId = id;

      if (!window.supabase || !id) {
        loading.classList.add("hidden");
        errorEl.classList.remove("hidden");
        return;
      }

      supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      const { data: row, error } = await supabaseClient
        .from(INVITES_TABLE)
        .select("*")
        .eq("id", id)
        .maybeSingle();

      if (error || !row) {
        console.error("Error loading invite:", error);
        loading.classList.add("hidden");
        errorEl.classList.remove("hidden");
        return;
      }

      // HERO
      document.getElementById("hero-bride").textContent = row.bride || "Bride";
      document.getElementById("hero-groom").textContent = row.groom || "Groom";
      document.getElementById("hero-date").textContent = formatDate(row.wedding_date);
      document.getElementById("hero-time").textContent = formatTime(row.wedding_time);

      document.getElementById("hero-venue").textContent = (
        row.main_venue_label || row.ceremony_name || row.ceremony_address || ""
      ).toString().toUpperCase();

      // Reception line under church venue
      const receptionLabel = document.getElementById("hero-reception-label");
      const receptionVenue = document.getElementById("hero-reception-venue");
      if (hasText(row.reception_name) || hasText(row.reception_address)) {
        receptionLabel.classList.remove("hidden");
        receptionVenue.classList.remove("hidden");
        receptionVenue.textContent = (row.reception_name || row.reception_address || "").toString().toUpperCase();
      } else {
        receptionLabel.classList.add("hidden");
        receptionVenue.classList.add("hidden");
      }

      // ðŸ” Topbar text
      const topNamesMain = document.getElementById("topbar-names-main");
      const topNamesSub = document.getElementById("topbar-names-sub");

      if (topNamesMain) {
        const bride = row.bride || "Bride";
        const groom = row.groom || "Groom";
        topNamesMain.textContent = `${bride} & ${groom}`;
      }
      if (topNamesSub) {
        const dateStr = formatDate(row.wedding_date);
        const timeStr = formatTime(row.wedding_time);
        topNamesSub.textContent = [dateStr, timeStr].filter(Boolean).join(" Â· ");
      }

      // Setup countdown
      setupCountdown(row.wedding_date, row.wedding_time);

      // Photos
      if (row.media_photos) {
        galleryPhotos = Array.isArray(row.media_photos)
          ? row.media_photos
          : String(row.media_photos).split(",").map((s) => s.trim()).filter(Boolean);
      } else {
        galleryPhotos = [];
      }

      const heroUrl = galleryPhotos[0] || row.ceremony_photo_url || row.reception_photo_url || "";
      if (heroUrl) {
        const avatarEl = document.getElementById("topbar-avatar");
        if (avatarEl) avatarEl.src = heroUrl;

        const heroBg = document.getElementById("hero-bg");
        if (heroBg) {
          heroBg.style.backgroundImage = "url('" + heroUrl + "')";
          setTimeout(() => heroBg.classList.add("loaded"), 100);
        }

        const s1 = document.getElementById("slide-1");
        if (s1) s1.src = heroUrl;
        startHeroSlideshow();
      }

      // STORY / proposal / verse (and hide section if empty)
      const storyText = hasText(row.our_story) ? row.our_story : "";
      const proposalText = hasText(row.proposal_story) ? row.proposal_story : "";
      const verseText = hasText(row.verse_text) ? row.verse_text : "";
      const verseRef = hasText(row.verse_reference) ? row.verse_reference : "";

      const storySection = document.getElementById("story-section");
      const shouldShowStory = hasText(storyText) || hasText(proposalText) || hasText(verseText);

      if (shouldShowStory) {
        document.getElementById("our-story").textContent = storyText;
        document.getElementById("proposal-story").textContent = proposalText;

        if (hasText(verseText)) {
          document.getElementById("verse-block").classList.remove("hidden");
          document.getElementById("verse-text").textContent = '"' + verseText + '"';
          document.getElementById("verse-ref").textContent = verseRef;
        } else {
          document.getElementById("verse-block").classList.add("hidden");
        }

        storySection.classList.remove("hidden");
        toggleNavFor("story-section", true);
      } else {
        storySection.classList.add("hidden");
        toggleNavFor("story-section", false);
      }

      // Ceremony
      const hasCeremony = hasText(row.ceremony_name) || hasText(row.ceremony_address) || hasText(row.ceremony_notes) || hasText(row.ceremony_photo_url) || hasText(row.ceremony_map_url);
      if (hasCeremony) {
        document.getElementById("ceremony-name").textContent = row.ceremony_name || "Ceremony";
        document.getElementById("ceremony-address").textContent = row.ceremony_address || "";
        document.getElementById("ceremony-notes").textContent = row.ceremony_notes || "";

        if (hasText(row.ceremony_map_url)) {
          const el = document.getElementById("ceremony-map");
          el.href = row.ceremony_map_url;
          el.classList.remove("hidden");
        }

if (hasText(row.ceremony_photo_url)) {
  const wrap = document.getElementById("ceremony-photo-wrap");
  const img = document.getElementById("ceremony-photo");
  img.src = row.ceremony_photo_url;
  wrap.style.display = "block";

  if (hasText(row.ceremony_map_url)) {
    const qrBox = document.getElementById("ceremony-qr");
    const qrImg = document.getElementById("ceremony-qr-img");
    const qrLabel = document.getElementById("ceremony-qr-label");

    qrImg.src = qrUrl(row.ceremony_map_url, 220);
    qrBox.classList.remove("hidden");
    qrLabel.classList.remove("hidden");
  }
}

      } else {
        document.getElementById("ceremony-card").classList.add("hidden");
      }

      // Reception
      const hasReception = hasText(row.reception_name) || hasText(row.reception_address) || hasText(row.reception_notes) || hasText(row.reception_photo_url) || hasText(row.reception_map_url);
      if (hasReception) {
        document.getElementById("reception-name").textContent = row.reception_name || "Reception";
        document.getElementById("reception-address").textContent = row.reception_address || "";
        document.getElementById("reception-notes").textContent = row.reception_notes || "";

        if (hasText(row.reception_map_url)) {
          const el = document.getElementById("reception-map");
          el.href = row.reception_map_url;
          el.classList.remove("hidden");
        }

if (hasText(row.reception_photo_url)) {
  const wrap = document.getElementById("reception-photo-wrap");
  const img = document.getElementById("reception-photo");
  img.src = row.reception_photo_url;
  wrap.style.display = "block";

  if (hasText(row.reception_map_url)) {
    const qrBox = document.getElementById("reception-qr");
    const qrImg = document.getElementById("reception-qr-img");
    const qrLabel = document.getElementById("reception-qr-label");

    qrImg.src = qrUrl(row.reception_map_url, 220);
    qrBox.classList.remove("hidden");
    qrLabel.classList.remove("hidden");
  }
}

      } else {
        document.getElementById("reception-card").classList.add("hidden");
      }

      // Hide whole Wedding Day section if both cards hidden
      const weddingDaySection = document.getElementById("weddingday-section");
      const ceremonyHidden = document.getElementById("ceremony-card").classList.contains("hidden");
      const receptionHidden = document.getElementById("reception-card").classList.contains("hidden");
      const showWeddingDay = !(ceremonyHidden && receptionHidden);
      weddingDaySection.classList.toggle("hidden", !showWeddingDay);
      toggleNavFor("weddingday-section", showWeddingDay);

      // Dress code (own section after entourage)
      const dressSection = document.getElementById("dress-section");
      const hasDress =
        hasText(row.dress_title) ||
        hasText(row.dress_description) ||
        hasText(row.dress_color1) ||
        hasText(row.dress_color2) ||
        hasText(row.dress_color3);

      if (hasDress) {
        dressSection.classList.remove("hidden");
        document.getElementById("dress-title").textContent = row.dress_title || "Formal";
        document.getElementById("dress-desc").textContent = row.dress_description || "";
        const pal = document.getElementById("dress-colors");
        pal.innerHTML = "";
        [row.dress_color1, row.dress_color2, row.dress_color3]
          .filter(hasText)
          .forEach((c, i) => {
            const d = document.createElement("div");
            d.className = "p-circle anim-scale delay-" + (i + 1) * 100;
            d.style.background = c;
            pal.appendChild(d);
          });

        toggleNavFor("dress-section", true);
      } else {
        dressSection.classList.add("hidden");
        toggleNavFor("dress-section", false);
      }

      // ===== HOTELS RENDER =====
const hotelsSection = document.getElementById("hotels-section");
const hotelsGrid = document.getElementById("hotels-grid");

hotelsGrid.innerHTML = "";

const hotels = Array.isArray(row.hotels) ? row.hotels : [];

const cleanHotels = hotels
  .filter(h => h && (hasText(h.name) || hasText(h.photo_url) || hasText(h.map_url) || hasText(h.link)))
  .map(h => ({
    name: hasText(h.name) ? String(h.name).trim() : "Hotel",
    map_url: hasText(h.map_url) ? String(h.map_url).trim() : "",
    link: hasText(h.link) ? String(h.link).trim() : "",
    photo_url: hasText(h.photo_url) ? String(h.photo_url).trim() : ""
  }));

if (cleanHotels.length > 0) {
  hotelsSection.classList.remove("hidden");
  toggleNavFor("hotels-section", true);

  cleanHotels.forEach((h, idx) => {
    const card = document.createElement("div");
    card.className = "hotel-card anim-up delay-" + (((idx % 3) + 2) * 100);

    const photo = document.createElement("img");
    photo.className = "hotel-photo";
    photo.alt = h.name;
    photo.src = h.photo_url || "https://via.placeholder.com/900x600?text=Hotel+Photo";

    const body = document.createElement("div");
    body.className = "hotel-body";

    const name = document.createElement("div");
    name.className = "hotel-name";
    name.textContent = h.name;

    const actions = document.createElement("div");
    actions.className = "hotel-actions";

    // Directions button (map_url)
    if (hasText(h.map_url)) {
      const dir = document.createElement("a");
      dir.className = "btn-gold";
      dir.href = h.map_url;
      dir.target = "_blank";
      dir.rel = "noopener";
      dir.textContent = "Directions";
      actions.appendChild(dir);
    }

    // QR code (website link)
    if (hasText(h.link)) {
      const qrWrap = document.createElement("div");
      qrWrap.className = "hotel-qr-wrap";

      const qrImg = document.createElement("img");
      qrImg.className = "hotel-qr";
      qrImg.alt = "QR code for " + h.name;
      qrImg.src = qrUrl(h.link, 220);

      const qrNote = document.createElement("div");
      qrNote.className = "hotel-qr-note";
      qrNote.textContent = "Scan to open website";

      const linkA = document.createElement("a");
      linkA.className = "hotel-link";
      linkA.href = h.link;
      linkA.target = "_blank";
      linkA.rel = "noopener";
      linkA.textContent = "Open Website";

      qrWrap.appendChild(qrImg);
      qrWrap.appendChild(qrNote);
      qrWrap.appendChild(linkA);

      body.appendChild(qrWrap);
    }

    body.appendChild(name);
    body.appendChild(actions);

    // NOTE: Put name/actions above QR? If you prefer name first, swap order:
    // (Currently: name/actions then QR appended after if exists, but we appended QR before name above.)
    // Fix ordering:
    body.innerHTML = "";
    body.appendChild(name);
    body.appendChild(actions);
    if (hasText(h.link)) {
      const qrWrap = document.createElement("div");
      qrWrap.className = "hotel-qr-wrap";

      const qrImg = document.createElement("img");
      qrImg.className = "hotel-qr";
      qrImg.alt = "QR code for " + h.name;
      qrImg.src = qrUrl(h.link, 220);

      const qrNote = document.createElement("div");
      qrNote.className = "hotel-qr-note";
      qrNote.textContent = "Scan to open website";

      const linkA = document.createElement("a");
      linkA.className = "hotel-link";
      linkA.href = h.link;
      linkA.target = "_blank";
      linkA.rel = "noopener";
      linkA.textContent = "Open Website";

      qrWrap.appendChild(qrImg);
      qrWrap.appendChild(qrNote);
      qrWrap.appendChild(linkA);
      body.appendChild(qrWrap);
    }

    card.appendChild(photo);
    card.appendChild(body);

    hotelsGrid.appendChild(card);
  });

  // show divider (optional)
  const afterHotels = document.querySelector('[data-divider="after-hotels"]');
  if (afterHotels) afterHotels.classList.toggle("hidden", false);
} else {
  hotelsSection.classList.add("hidden");
  toggleNavFor("hotels-section", false);

  const afterHotels = document.querySelector('[data-divider="after-hotels"]');
  if (afterHotels) afterHotels.classList.toggle("hidden", true);
}


      // Gallery
      const grid = document.getElementById("gallery-grid");
      grid.innerHTML = "";
      if (galleryPhotos.length > 0) {
        galleryPhotos.forEach((url, index) => {
          const img = document.createElement("img");
          img.src = url;
          img.className = "anim-up delay-" + ((index % 3) * 100 + 200);
          img.onclick = () => openLightbox(index);
          grid.appendChild(img);
        });
        document.getElementById("gallery-section").classList.remove("hidden");
        toggleNavFor("gallery-section", true);
      } else {
        document.getElementById("gallery-section").classList.add("hidden");
        toggleNavFor("gallery-section", false);
      }

      // Sponsors / entourage (hide if no content)
      const spCon = document.getElementById("sponsor-container");
      spCon.innerHTML = "";
      const addSp = (head, txt) => {
        if (!hasText(txt)) return;
        const div = document.createElement("div");
        div.className = "sponsor-category anim-up";
        div.innerHTML =
          '<div class="sp-head">' +
          head +
          '</div><div class="sp-names">' +
          String(txt) +
          "</div>";
        spCon.appendChild(div);
      };
      addSp("Principal Sponsors", row.principal_sponsors);
      addSp("Parents of the Bride", row.parents_bride);
      addSp("Parents of the Groom", row.parents_groom);
      addSp("Team Bride", row.maid_of_honor_block);
      addSp("Team Groom", row.best_man_block);
      addSp("Pastors", row.secondary_sponsors);
      addSp("Flower Girls", row.flower_girls);
      addSp("Ring Bearer", row.ring_bearer);
      addSp("Coin Bearer", row.other_roles);

      const sponsorsSection = document.getElementById("sponsors-section");
      const showSponsors = spCon.children.length > 0;
      sponsorsSection.classList.toggle("hidden", !showSponsors);
      toggleNavFor("sponsors-section", showSponsors);

      // Video
      const videoSection = document.getElementById("video-section");
      if (hasText(row.media_video_url)) {
        const src = getYoutubeSrc(row.media_video_url);
        if (src) {
          videoSection.classList.remove("hidden");
          document.getElementById("video-frame").innerHTML =
            '<iframe src="' +
            src +
            '" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>';
          toggleNavFor("video-section", true);
        } else {
          videoSection.classList.add("hidden");
          toggleNavFor("video-section", false);
        }
      } else {
        videoSection.classList.add("hidden");
        toggleNavFor("video-section", false);
      }

      // RSVP + footer note (RSVP always available)
      const rsvpDateEl = document.getElementById("rsvp-date");
      if (hasText(row.rsvp_deadline)) {
        rsvpDateEl.textContent = formatDate(row.rsvp_deadline);
      } else {
        rsvpDateEl.textContent = "Please respond";
      }
      document.getElementById("footer-note").textContent =
        row.rsvp_note || "Thank you for celebrating with us.";

      // Attach RSVP button handler
      const rsvpBtn = document.getElementById("rsvp-button");
      if (rsvpBtn) rsvpBtn.addEventListener("click", handleRSVP);

      // âœ… Dividers: hide if nothing between sections
      // If story hidden, the divider after story should still make sense; we handle by showing/hiding per section:
      const afterStory = document.querySelector('[data-divider="after-story"]');
      if (afterStory) afterStory.classList.toggle("hidden", !shouldShowStory);

      const afterWeddingDay = document.querySelector('[data-divider="after-weddingday"]');
      // hide divider if BOTH wedding day and gallery are hidden
      const showGallery = !document.getElementById("gallery-section").classList.contains("hidden");
      if (afterWeddingDay) afterWeddingDay.classList.toggle("hidden", !(showWeddingDay || showGallery || showSponsors || hasDress));

      loading.classList.add("hidden");
      root.classList.remove("hidden");
      setTimeout(startAnimations, 100);
    }

    /* --- LIGHTBOX LOGIC --- */
    const lb = document.getElementById("lightbox");
    const lbImg = document.getElementById("lb-img");

    function openLightbox(index) {
      currentPhotoIndex = index;
      updateLightboxImage();
      lb.classList.add("open");
    }

    function updateLightboxImage() {
      if (galleryPhotos.length === 0) return;
      lbImg.classList.add("fade-out");
      setTimeout(() => {
        lbImg.src = galleryPhotos[currentPhotoIndex];
        lbImg.onload = () => lbImg.classList.remove("fade-out");
      }, 250);
    }

    function nextImage() {
      currentPhotoIndex = (currentPhotoIndex + 1) % galleryPhotos.length;
      updateLightboxImage();
    }

    function prevImage() {
      currentPhotoIndex = (currentPhotoIndex - 1 + galleryPhotos.length) % galleryPhotos.length;
      updateLightboxImage();
    }

    document.getElementById("lb-close").onclick = () => lb.classList.remove("open");
    lb.onclick = (e) => {
      if (e.target === lb || e.target.classList.contains("lb-container")) {
        lb.classList.remove("open");
      }
    };

    document.addEventListener("keydown", (e) => {
      if (!lb.classList.contains("open")) return;
      if (e.key === "ArrowRight") nextImage();
      if (e.key === "ArrowLeft") prevImage();
      if (e.key === "Escape") lb.classList.remove("open");
    });

    let touchStartX = 0;
    let touchEndX = 0;
    lb.addEventListener("touchstart", (e) => { touchStartX = e.changedTouches[0].screenX; }, false);
    lb.addEventListener("touchend", (e) => {
      touchEndX = e.changedTouches[0].screenX;
      if (touchEndX < touchStartX - 50) nextImage();
      if (touchEndX > touchStartX + 50) prevImage();
    }, false);

    // --- TOPBAR MENU TOGGLE ---
    const menuBtn = document.getElementById("topbar-menu-btn");
    const topNav = document.getElementById("topbar-nav");

    if (menuBtn && topNav) {
      menuBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        menuBtn.classList.toggle("open");
        topNav.classList.toggle("open");
      });

      // Close menu when clicking a link (mobile)
      topNav.querySelectorAll("a").forEach((link) => {
        link.addEventListener("click", () => {
          menuBtn.classList.remove("open");
          topNav.classList.remove("open");
        });
      });

      // Close when tapping outside
      document.addEventListener("click", (e) => {
        if (!topNav.contains(e.target) && !menuBtn.contains(e.target)) {
          menuBtn.classList.remove("open");
          topNav.classList.remove("open");
        }
      });
    }

    init();
  </script>
</body>
</html>
